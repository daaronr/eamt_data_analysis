<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.113">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EA Market testing data analysis - 4&nbsp; OftW pre-GT-email upsell (impact/emotion)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: 1;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/tlycs_input_simple_analysis.html" rel="next">
<link href="../chapters/gwwc_pledge_wip.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">OftW pre-GT-email upsell (impact/emotion)</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">EA Market testing data analysis</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/daaronr/eamt_data_analysis" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/gwwc_gg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Giving What We Can: Giving guides</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/gwwc_fb.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Giving What We Can: Feb 22 Facebook Message Test</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/gwwc_pledge_wip.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">(GWWC: Pledge page trial)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/oftw_upsell_input_first_analysis.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">OftW pre-GT-email upsell (impact/emotion)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/tlycs_input_simple_analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">TLYCS Portland trial: Brief report</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-trial" id="toc-the-trial" class="nav-link active" data-scroll-target="#the-trial"><span class="toc-section-number">4.1</span>  The trial</a></li>
  <li><a href="#capturing-data" id="toc-capturing-data" class="nav-link" data-scroll-target="#capturing-data"><span class="toc-section-number">4.2</span>  Capturing data</a></li>
  <li><a href="#input-and-clean-data" id="toc-input-and-clean-data" class="nav-link" data-scroll-target="#input-and-clean-data"><span class="toc-section-number">4.3</span>  Input and clean data</a>
  <ul class="collapse">
  <li><a href="#labeling-and-cleaning" id="toc-labeling-and-cleaning" class="nav-link" data-scroll-target="#labeling-and-cleaning"><span class="toc-section-number">4.3.1</span>  Labeling and cleaning</a></li>
  <li><a href="#constructing-outcome-measures-especially-donations-likely-driven-by-email" id="toc-constructing-outcome-measures-especially-donations-likely-driven-by-email" class="nav-link" data-scroll-target="#constructing-outcome-measures-especially-donations-likely-driven-by-email"><span class="toc-section-number">4.3.2</span>  Constructing outcome measures, especially ‘donations likely driven by email’</a></li>
  </ul></li>
  <li><a href="#descriptives-and-exploratory-analysis" id="toc-descriptives-and-exploratory-analysis" class="nav-link" data-scroll-target="#descriptives-and-exploratory-analysis"><span class="toc-section-number">4.4</span>  Descriptives and exploratory analysis</a>
  <ul class="collapse">
  <li><a href="#donation-and-outcome-summary-statistics-by-treatment" id="toc-donation-and-outcome-summary-statistics-by-treatment" class="nav-link" data-scroll-target="#donation-and-outcome-summary-statistics-by-treatment"><span class="toc-section-number">4.4.1</span>  Donation and outcome summary statistics, by treatment</a></li>
  </ul></li>
  <li><a href="#basic-tests-donation-incidence-and-amounts" id="toc-basic-tests-donation-incidence-and-amounts" class="nav-link" data-scroll-target="#basic-tests-donation-incidence-and-amounts"><span class="toc-section-number">4.5</span>  Basic tests: Donation incidence and amounts</a></li>
  <li><a href="#basic-tests-clicks-and-retention-outcomes" id="toc-basic-tests-clicks-and-retention-outcomes" class="nav-link" data-scroll-target="#basic-tests-clicks-and-retention-outcomes"><span class="toc-section-number">4.6</span>  Basic tests: Clicks and retention outcomes</a>
  <ul class="collapse">
  <li><a href="#difference-between-two-binomial-random-variables-bayesian-binomial-test" id="toc-difference-between-two-binomial-random-variables-bayesian-binomial-test" class="nav-link" data-scroll-target="#difference-between-two-binomial-random-variables-bayesian-binomial-test"><span class="toc-section-number">4.6.1</span>  Difference between two binomial random variables: Bayesian binomial test</a></li>
  <li><a href="#redoing-a-bunch-of-stuff-manually" id="toc-redoing-a-bunch-of-stuff-manually" class="nav-link" data-scroll-target="#redoing-a-bunch-of-stuff-manually"><span class="toc-section-number">4.6.2</span>  Redoing a bunch of stuff manually</a></li>
  <li><a href="#adaptation-of-this-magnitude-or-smaller" id="toc-adaptation-of-this-magnitude-or-smaller" class="nav-link" data-scroll-target="#adaptation-of-this-magnitude-or-smaller"><span class="toc-section-number">4.6.3</span>  Adaptation: ‘of this magnitude or smaller’</a></li>
  <li><a href="#quick-redo-assuming-equal-shares-recieved-each-email-and-treating-email-reciepts-as-denom" id="toc-quick-redo-assuming-equal-shares-recieved-each-email-and-treating-email-reciepts-as-denom" class="nav-link" data-scroll-target="#quick-redo-assuming-equal-shares-recieved-each-email-and-treating-email-reciepts-as-denom"><span class="toc-section-number">4.6.4</span>  Quick redo assuming equal shares recieved each email, and treating ‘email reciepts as denom’</a></li>
  </ul></li>
  <li><a href="#demographics-and-interactions-to-do" id="toc-demographics-and-interactions-to-do" class="nav-link" data-scroll-target="#demographics-and-interactions-to-do"><span class="toc-section-number">4.7</span>  Demographics and interactions (to do)</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/daaronr/eamt_data_analysis/edit/main/chapters/oftw_upsell_input_first_analysis.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/daaronr/eamt_data_analysis/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="oftw_pregt" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">OftW pre-GT-email upsell (impact/emotion)</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>OftW pre-giving-tuesday-email upselling split test (considering ‘impact vs emotion’) c</p>
<p><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<section id="the-trial" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="the-trial"><span class="header-section-number">4.1</span> The trial</h2>
<p>In December 2021, <a href="https://www.1fortheworld.org/">One For the World</a> (OftW) sent out a sequence of emails to existing OftW pledgers/participants asking them for an additional donation. There were two ‘treatment variants’; an emotional email and a standard impact-based email. The treatment was constant by individual (the same person always got emails with the same theme).</p>
<p>The details are presented in our gitbook <a href="https://effective-giving-marketing.gitbook.io/untitled/contexts-partner-organizations-trials/one-for-the-world-oftw/pre-giving-tuesday-email-split-test-+">HERE</a> and in the preregistration linked within (also on OSF).</p>
</section>
<section id="capturing-data" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="capturing-data"><span class="header-section-number">4.2</span> Capturing data</h2>
<p>Kennan and Chloe captured the data and metadata from</p>
<ol type="1">
<li>The OFTW database</li>
<li>SurveyMonkey</li>
</ol>
<p>Putting this into the (private) Google sheet linked <a href="https://docs.google.com/spreadsheets/d/1iUKXkEqoadBgtUG_epBzUzCgA_J5mdWWstcXtpAdNJs/edit#gid=521638649">HERE</a>. We added some metadata/explainers to that data.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<!-- (This is gitignored so it won't be 'committed' to our repo, at least for now)

Quick note here on how Kennan put the (different types of) data together in that Gsheet. We probably should use the API tool to import it directly here. -->
</section>
<section id="input-and-clean-data" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="input-and-clean-data"><span class="header-section-number">4.3</span> Input and clean data</h2>
<p>We input the sheets from the external Google sheet location (access required)…</p>
<div class="cell">
<details>
<summary>oftw_21_22_mc</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gs4_auth</span>(<span class="at">scope =</span> <span class="st">"https://www.googleapis.com/auth/drive"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drive_auth</span>(<span class="at">token =</span> <span class="fu">gs4_token</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Mailchimp data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc <span class="ot">&lt;-</span> <span class="fu">read_sheet</span>(<span class="st">"https://docs.google.com/spreadsheets/d/1iUKXkEqoadBgtUG_epBzUzCgA_J5mdWWstcXtpAdNJs/edit#gid=521638649"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet=</span><span class="st">"Raw data (Mailchimp)"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Treatment group</span><span class="st">`</span>) <span class="sc">%&gt;%</span>  <span class="co">#remove an un-useful repeated name column</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Treatment Group</span><span class="st">`</span> <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(<span class="st">`</span><span class="at">Treatment Group</span><span class="st">`</span>, <span class="sc">~</span> .[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Email Address</span><span class="st">`</span>, <span class="st">`</span><span class="at">Email Date</span><span class="st">`</span>, <span class="st">`</span><span class="at">Treatment Group</span><span class="st">`</span>, Opens, <span class="st">`</span><span class="at">Donate link clicks</span><span class="st">`</span>, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> <span class="co">#Most relevant features organized first</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">Email Address</span><span class="st">`</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#later: remove features brought in from OFTW database, reconstruct it</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse=</span><span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Email Address, Email Date, Treatment Group, Opens, Donate link clicks, sheet_descriptor, First Name, Last Name, Email Number, Class Year, Donor status, Total Given, Donation amount, Donation frequency, Start string, Platform, Portfolio string, Class lead, Impact 1, Impact 2, Impact 3, Employer, Pledge string, School string, Pledge year, Cancellation Type, Donation Amount String, OFTW matching, OFTW match amount, Corporate match amount, Bonuses announced, Post-bonus contact date, Email Preferences, Start Date, Lives Saved, Member Rating, Record rank, Total Giving Season contributions, Total Giving Season contribution amount"</code></pre>
</div>
<details>
<summary>oftw_21_22_mc</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#...input descriptors for the above (do this later from "doc: ...Mailchimp" sheet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>oftw_21_22_db_don</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Donations data (and OftW database info)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="ot">&lt;-</span> <span class="fu">read_sheet</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://docs.google.com/spreadsheets/d/1iUKXkEqoadBgtUG_epBzUzCgA_J5mdWWstcXtpAdNJs/edit#gid=521638649"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet=</span><span class="st">"Giving Season contributions (BigQuery)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Treatment group</span><span class="st">`</span> <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(<span class="st">`</span><span class="at">Treatment group</span><span class="st">`</span>, <span class="sc">~</span> .[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">email</span><span class="st">`</span>, <span class="st">`</span><span class="at">primary_email</span><span class="st">`</span>, <span class="st">`</span><span class="at">donation_date</span><span class="st">`</span>, <span class="st">`</span><span class="at">Net_Contribution_Amount_USD</span><span class="st">`</span>, <span class="st">`</span><span class="at">payment_platform</span><span class="st">`</span>, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  <span class="co">#Most relevant features organized first</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(donation_date<span class="sc">&gt;=</span><span class="fu">as.Date</span>(<span class="st">"2021-11-15"</span>)) <span class="co"># At least for now, remove pre-treatment donation data</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse=</span><span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "email, primary_email, donation_date, Net_Contribution_Amount_USD, payment_platform, Treatment group, Number of email opens, oftw_partner, school, chapter_type, portfolio, contribution_frequency, pledge_date, pledge_start_date, pledge_end_date, donor_status, cancellation_type, pledge_amount, pledge_contribution_frequency, x"</code></pre>
</div>
</div>
<!--

For the first question, we'll need to transform the contribution data to look at how many contributions came from people in each group who actually opened the emails (Column D) and then further subset it to just website donations (ie Column I = "Squarespace").

For the second, I just updated the formulas in both of those columns. Remember that, since the Raw Data (Mailchimp) tab holds one observation for each email-open by a given donor, an individual donor may appear up to five times. Accordingly, summing these aggregated columns will vastly inflate the totals. We may be better off making a unique() call to the emails and constructing a donor-level dataset separately. Happy to talk more tomorrow (or next week if those times don't work).
-->
<section id="labeling-and-cleaning" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="labeling-and-cleaning"><span class="header-section-number">4.3.1</span> Labeling and cleaning</h3>
<p>The code …</p>
<p>…makes names <code>snake_case</code>, using original names as labels…</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(oftw_21_22_mc) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_21_22_mc)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(oftw_21_22_mc) <span class="ot">&lt;-</span> snakecase<span class="sc">::</span><span class="fu">to_snake_case</span>(<span class="fu">names</span>(oftw_21_22_mc))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(oftw_21_22_db_don) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_21_22_db_don)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(oftw_21_22_db_don) <span class="ot">&lt;-</span> snakecase<span class="sc">::</span><span class="fu">to_snake_case</span>(<span class="fu">names</span>(oftw_21_22_db_don))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--Todo: Remove useless columns -->
<p>…and anonymizes the data, hashing anything with the chance of being identifying</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>salty_hash <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">salt</span>(<span class="at">.seed =</span> <span class="dv">42</span>, x) <span class="sc">%&gt;%</span> <span class="fu">hash</span>(<span class="at">.algo =</span> <span class="st">"crc32"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc <span class="ot">&lt;-</span> oftw_21_22_mc <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>first_name, <span class="sc">-</span>last_name) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(email_address,  employer, school_string), salty_hash))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="ot">&lt;-</span> oftw_21_22_db_don <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(primary_email, email, school), salty_hash))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Roll up to 1 per person; summarize and pivot_wider</p>
<div class="cell">
<details>
<summary>rollup</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>outcomes_base_mc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"opens"</span>, <span class="st">"donate_link_clicks"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc_wide <span class="ot">&lt;-</span> oftw_21_22_mc <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treat_emotion =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    treatment_group <span class="sc">==</span> <span class="st">"1.000000"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    treatment_group <span class="sc">==</span> <span class="st">"2.000000"</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(email_address) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(outcomes_base_mc), sum, <span class="at">.names =</span> <span class="st">"{.col}_tot"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> email_number,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">"opens"</span>, <span class="st">"donate_link_clicks"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_click_don_link =</span> donate_link_clicks_tot <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(email_address) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="ot">&lt;-</span> oftw_21_22_db_don <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(email) <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">don_tot =</span> <span class="fu">sum</span>(net_contribution_amount_usd),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_don =</span> <span class="fu">n</span>(),</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_don =</span> num_don <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">don_tot_ot =</span> <span class="fu">sum</span>(net_contribution_amount_usd[contribution_frequency <span class="sc">==</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"One-time"</span>]),</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_don_ot =</span> <span class="fu">sum</span>(contribution_frequency <span class="sc">==</span> <span class="st">"One-time"</span>),</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_don_ot =</span> num_don_ot <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#WAIT THIS IS NOT WIDE DATA -- don't interpret it as 'number of individuals'</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">don_tot_ss =</span> <span class="fu">sum</span>(net_contribution_amount_usd[payment_platform <span class="sc">==</span> <span class="st">"Squarespace"</span>]),</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_don_ss =</span> <span class="fu">sum</span>(payment_platform <span class="sc">==</span> <span class="st">"Squarespace"</span>),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_don_ss =</span> num_don_ss <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don_persons <span class="ot">&lt;-</span> oftw_21_22_db_don <span class="sc">%&gt;%</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(email) <span class="sc">%&gt;%</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)     <span class="sc">%&gt;%</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">treat_emotion =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        treatment_group<span class="sc">==</span><span class="st">"1.000000"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        treatment_group <span class="sc">==</span> <span class="st">"2.000000"</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>oftw_mc_db <span class="ot">&lt;-</span> <span class="fu">power_full_join</span>(oftw_21_22_mc_wide,</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>   oftw_21_22_db_don_persons,  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"email_address"</span> <span class="ot">=</span> <span class="st">"email"</span>), <span class="at">conflict =</span> coalesce_xy) <span class="sc">%&gt;%</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_don"</span>), <span class="sc">~</span><span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)), <span class="co">#make it a 0 if it's not in the donation database</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>   <span class="at">d_open=</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_openers <span class="ot">&lt;-</span> oftw_mc_db <span class="sc">%&gt;%</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion))</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co"># oftw_21_22_db_don_wide &lt;- oftw_21_22_db_don %&gt;%</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(email, donation_date, net_contribution_amount_usd, payment_platform) %&gt;%</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="co">#    group_by(email) %&gt;%</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co">#    mutate(row = row_number()) %&gt;%</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co">#       tidyr::pivot_wider(names_from = row, values_from = c("donation_date", "net_contribution_amount_usd"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Prelim results</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>oftw_mc_db <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> treat_emotion    0   1
             0 1139 273
             1  968 231
            NA    0 395</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>oftw_mc_db <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don_ss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> treat_emotion    0 1
             0 1404 8
             1 1190 9
            NA  391 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don_persons <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don_ot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> treat_emotion FALSE TRUE NA_
             0   248   15  10
             1   215   12   4
            NA   328   59   8</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#todo: simple statistical measures along with this</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="constructing-outcome-measures-especially-donations-likely-driven-by-email" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="constructing-outcome-measures-especially-donations-likely-driven-by-email"><span class="header-section-number">4.3.2</span> Constructing outcome measures, especially ‘donations likely driven by email’</h3>
<ol type="1">
<li>Donations (presence, count, amounts) in giving seasons, 1 row per user (with treatment etc.)</li>
</ol>
<ul>
<li>overall</li>
<li>non-regular</li>
<li>‘likely from email’</li>
</ul>
<p>are in Giving Season contributions (BigQuery)</p>
<ul>
<li>subset for payment platform = squarespace (unlikely to come from any other checkout page)</li>
<li>email as primary key, link to <code>Raw Data (mailchimp)</code>, filter on ‘Donate link clicks`&gt;0 (note that one needs aggregating by donor because it is ’per email’)</li>
</ul>
<ol start="2" type="1">
<li>Giving season donations ..</li>
</ol>
<p>Giving Season contributions (BigQuery), sum donation_date Net_Contribution_Amount_USD with filters for one-time etc</p>
<p>Can check against fields ‘Total Giving Season contributions Total Giving Season contribution amount’</p>
<!-- Could make a nested array:
- Dates emails sent, number of clicks per email
- Dates donations made, donation amount -->
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#list/matrix of rates for later use</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>oc_mat <span class="ot">&lt;-</span> oftw_mc_db <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_open=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat_emotion) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_"</span>), <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"tot_{.col}"</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>oc_mat_r <span class="ot">&lt;-</span> oc_mat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion)) <span class="co">#where treatment observed</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>assigned_emails <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2000</span>) <span class="co">#I was told that about 4000 emails were sent, 2000 to each group</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="descriptives-and-exploratory-analysis" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="descriptives-and-exploratory-analysis"><span class="header-section-number">4.4</span> Descriptives and exploratory analysis</h2>
<p>Notes:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<section id="donation-and-outcome-summary-statistics-by-treatment" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="donation-and-outcome-summary-statistics-by-treatment"><span class="header-section-number">4.4.1</span> Donation and outcome summary statistics, by treatment</h3>
</section>
</section>
<section id="basic-tests-donation-incidence-and-amounts" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="basic-tests-donation-incidence-and-amounts"><span class="header-section-number">4.5</span> Basic tests: Donation incidence and amounts</h2>
<p>(See preregistration – go through preregistered tests one at a time. Note that given the observed conversion rates I do not expect any ‘significant differences’.)</p>
</section>
<section id="basic-tests-clicks-and-retention-outcomes" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="basic-tests-clicks-and-retention-outcomes"><span class="header-section-number">4.6</span> Basic tests: Clicks and retention outcomes</h2>
<p>I’m following the approach discussed in the ‘RP methods discussion’ under <a href="">“Significance and equivalence testing” with randomization inference/simulation; building to Bayes</a></p>
<p>We see a ‘small difference’ between treatment groups and it is ‘not significant in standard tests’ (tests not shown here yet). But can we put meaningful bounds on this? Can we statistically ‘rule out large effects’?</p>
<p>(This parallels the analysis done in <a href="https://rethinkpriorities.github.io/methodology-statistics-design/inference-and-rough-equivalence-testing-with-binomial-outcomes.html#how-likely-are-proportions-this-similar-under-different-size-true-effect-sizes">HERE</a>, which includes some further explanation of the methods)</p>
<p><br>
</p>
<section id="difference-between-two-binomial-random-variables-bayesian-binomial-test" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="difference-between-two-binomial-random-variables-bayesian-binomial-test"><span class="header-section-number">4.6.1</span> Difference between two binomial random variables: Bayesian binomial test</h3>
<div class="cell">
<details>
<summary>fill-in-data</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#would need to generate 'fill in data' if we want to use bayesAB, which requires actual vectors</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#add blank rows for 'assigned'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>blank_impact <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> assigned_emails[<span class="dv">1</span>]<span class="sc">-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">1</span>], <span class="at">ncol =</span> <span class="fu">NCOL</span>(oftw_mc_db)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
Using compatibility `.name_repair`.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
</div>
<details>
<summary>fill-in-data</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(blank_impact) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_mc_db)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>blank_impact <span class="sc">%&lt;&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_"</span>), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat_emotion=</span><span class="dv">0</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>blank_emotion <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> assigned_emails[<span class="dv">1</span>]<span class="sc">-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">2</span>], <span class="at">ncol =</span> <span class="fu">NCOL</span>(oftw_mc_db)))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(blank_emotion) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_mc_db)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>blank_emotion <span class="sc">%&lt;&gt;%</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_"</span>), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat_emotion=</span><span class="dv">1</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_assigned <span class="ot">&lt;-</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(oftw_mc_db, blank_impact, blank_emotion) <span class="sc">%&gt;%</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion))</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_assigned <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> treat_emotion    n percent
             0 2000     0.5
             1 2000     0.5</code></pre>
</div>
</div>
<p>Opens by treatment:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Following r https://www.sumsar.net/blog/2014/06/bayesian-first-aid-prop-test/</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># alt: http://frankportman.github.io/bayesAB/</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#opens_by_treat_fit &lt;- bayes.prop.test(oc_mat_r$tot_d_open, assigned_emails, cred.mass = 0.95) #here I highlight the 95% bounds because it's a strong effect!</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(opens_by_treat_fit)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>unif_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">'beta'</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(assigned_emails))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>opens_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>opens_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(opens_by_treat_AB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(opens_by_treat_AB_empir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-16-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-16-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#WTF -- I need to advance this by command prompt!?</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#AB1 &lt;- bayesTest(oftw_21_22_db_don_persons$d_don_ot[trea], B_binom, priors = c('alpha' = 65, 'beta' = 200), n_samples = 1e5, distribution = 'bernoulli')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br>
</p>
<p>‘Some donation’ by treatment (only for those who opened, otherwise donations are surely undercounted for Emotion treatment)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don_persons <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> treat_emotion TRUE
             0  273
             1  231
            NA  395</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  don_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don, oc_mat_r<span class="sc">$</span>tot_d_open, <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Bayesian First Aid proportion test

data: oc_mat_r$tot_d_don out of oc_mat_r$tot_d_open
number of successes:   273,  231
number of trials:     1412, 1199
Estimated relative frequency of success [80% credible interval]:
  Group 1: 0.19 [0.18, 0.21]
  Group 2: 0.19 [0.18, 0.21]
Estimated group difference (Group 1 - Group 2):
  0 [-0.02, 0.02]
The relative frequency of success is larger for Group 1 by a probability
of 0.515 and larger for Group 2 by a probability of 0.485 .</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_by_treat_opened_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>don_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>don_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_by_treat_AB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-18-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-18-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_by_treat_AB_empir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-18-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-18-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-18-7.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Thus we put 80% probability on the difference between the donation rates being no more than (hard-coded) .023/.19 = 12% in either direction. Note that this is not terribly narrowly bounded.</p>
<p><br>
</p>
<p><em>Next, for one-time donations only; again as a share of opens</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  don_ot_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ot, oc_mat_r<span class="sc">$</span>tot_d_open, <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Bayesian First Aid proportion test

data: oc_mat_r$tot_d_don_ot out of oc_mat_r$tot_d_open
number of successes:    15,   12
number of trials:     1412, 1199
Estimated relative frequency of success [80% credible interval]:
  Group 1: 0.011 [0.0075, 0.015]
  Group 2: 0.011 [0.0068, 0.014]
Estimated group difference (Group 1 - Group 2):
  0 [-0.0048, 0.0056]
The relative frequency of success is larger for Group 1 by a probability
of 0.55 and larger for Group 2 by a probability of 0.45 .</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ot), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ot_by_treat_AB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ot_by_treat_AB_empir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-20-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-20-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-20-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantiles of posteriors for A and B:

$Probability
$Probability$A
         0%         25%         50%         75%        100% 
0.002702340 0.009300256 0.011076158 0.013056869 0.028481793 

$Probability$B
         0%         25%         50%         75%        100% 
0.002578133 0.008699817 0.010557270 0.012664164 0.031399003 


--------------------------------------------

P(A &gt; B) by (0)%: 

$Probability
[1] 0.5518

--------------------------------------------

Credible Interval on (A - B) / B for interval length(s) (0.9) : 

$Probability
       5%       95% 
-0.434144  0.969118 

--------------------------------------------

Posterior Expected Loss for choosing A over B:

$Probability
[1] 0.1618676</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB_lift_int80 <span class="ot">&lt;-</span> don_ot_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB_lift_int80_empir <span class="ot">&lt;-</span> don_ot_by_treat_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>80% credible intervals with the uniform prior for the ‘lift’ of Impact relative to Emotion are</p>
<p>-0.351, 0.707</p>
<p>and for the empirically informed (but symmetric prior):</p>
<p>-0.234, 0.357</p>
<p>(Hard-coded) Here there is just a trace of suggestive evidence that the emotion treatment performed worse. But even our 80% bounds are very wide.</p>
<p><br>
</p>
<p><em>For ‘Squarespace donations only’; these are the donations that plausibly came from the email. First as a share of opens for each treatment :</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  don_ss_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss, oc_mat_r<span class="sc">$</span>tot_d_open, <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Bayesian First Aid proportion test

data: oc_mat_r$tot_d_don_ss out of oc_mat_r$tot_d_open
number of successes:     8,    9
number of trials:     1412, 1199
Estimated relative frequency of success [80% credible interval]:
  Group 1: 0.0062 [0.0033, 0.0085]
  Group 2: 0.0081 [0.0047, 0.011]
Estimated group difference (Group 1 - Group 2):
  0 [-0.0062, 0.0023]
The relative frequency of success is larger for Group 1 by a probability
of 0.282 and larger for Group 2 by a probability of 0.718 .</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_AB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_AB_empir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-22-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-22-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-22-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantiles of posteriors for A and B:

$Probability
$Probability$A
          0%          25%          50%          75%         100% 
0.0009902386 0.0048437368 0.0061367516 0.0076340142 0.0191421384 

$Probability$B
         0%         25%         50%         75%        100% 
0.001462728 0.006437438 0.008042132 0.009891706 0.025724099 


--------------------------------------------

P(A &gt; B) by (0)%: 

$Probability
[1] 0.27906

--------------------------------------------

Credible Interval on (A - B) / B for interval length(s) (0.9) : 

$Probability
        5%        95% 
-0.6515304  0.6391667 

--------------------------------------------

Posterior Expected Loss for choosing A over B:

$Probability
[1] 0.5346835</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB_lift_int80 <span class="ot">&lt;-</span> don_ss_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB_lift_int80_empir <span class="ot">&lt;-</span> don_ss_by_treat_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>80% credible intervals with the uniform prior for the ‘lift’ of Impact relative to Emotion are</p>
<p>-0.583, 0.383</p>
<p>and for the empirically informed (but symmetric prior):</p>
<p>-0.367, 0.304</p>
<p>(Hard-coded) Again, even our 80% bounds are very wide.</p>
<p><br>
</p>
<p>Finally, we consider the above as a share of total emails sent, allowing that ‘opens’ is non-random,</p>
<p>… and also implicitly assuming that the only impact of these treatments could be on the Squarespace donations made by someone who did open the email.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  don_ss_by_treat_opened_fit_all <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss, assigned_emails,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Bayesian First Aid proportion test

data: oc_mat_r$tot_d_don_ss out of assigned_emails
number of successes:     8,    9
number of trials:     2000, 2000
Estimated relative frequency of success [80% credible interval]:
  Group 1: 0.0043 [0.0025, 0.0062]
  Group 2: 0.0049 [0.0029, 0.0067]
Estimated group difference (Group 1 - Group 2):
  0 [-0.0033, 0.0022]
The relative frequency of success is larger for Group 1 by a probability
of 0.405 and larger for Group 2 by a probability of 0.595 .</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB package</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(assigned_emails))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bernoulli test</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_all_AB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_all_AB_empir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-24-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-24-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-24-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantiles of posteriors for A and B:

$Probability
$Probability$A
          0%          25%          50%          75%         100% 
0.0006591401 0.0034229384 0.0043367467 0.0053948239 0.0139389081 

$Probability$B
          0%          25%          50%          75%         100% 
0.0008503472 0.0038633646 0.0048302873 0.0059443205 0.0137935894 


--------------------------------------------

P(A &gt; B) by (0)%: 

$Probability
[1] 0.4076

--------------------------------------------

Credible Interval on (A - B) / B for interval length(s) (0.9) : 

$Probability
        5%        95% 
-0.5874267  0.9235146 

--------------------------------------------

Posterior Expected Loss for choosing A over B:

$Probability
[1] 0.353655</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB_lift_int80 <span class="ot">&lt;-</span> don_ss_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB_lift_int80_empir <span class="ot">&lt;-</span> don_ss_by_treat_all_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>80% credible intervals with the uniform prior for the ‘lift’ of Impact relative to Emotion are</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">op</span>(don_ss_by_treat_all_AB_lift_int80<span class="sc">$</span>interval<span class="sc">$</span>Probability)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     10%      90% 
"-0.507" " 0.621" </code></pre>
</div>
</div>
<p>and for the empirically informed (but symmetric prior):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">op</span>(don_ss_by_treat_all_AB_lift_int80_empir<span class="sc">$</span>interval<span class="sc">$</span>Probability)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     10%      90% 
"-0.329" " 0.379" </code></pre>
</div>
</div>
<p>Hard-coded: Here there is almost no evidence in either direction. However, our 80% credible intervals remain wide.</p>
<p><br>
</p>
<p>Unfortunately, this experiment proved to be underpowered, at least for the donation outcome.</p>
<p><strong>But what about clicks on the ‘donation link’?</strong> This could arguably be seen as a measure of ‘desire and intention to donate’, and thus might be a more fine-grained and less noisy measure, improving our statistical power.</p>
<p>Some quick crosstabs (here as a share of <em>opens</em>)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  donclick_by_treat <span class="ot">&lt;-</span>  oftw_mc_db <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion)) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(treat_emotion, d_click_don_link) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_percentages</span>(<span class="st">"row"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_ns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_title</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span><span class="st">"Click on donation link by treatment; all opened emails"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">"scale_down"</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>Click on donation link by treatment; all opened emails</caption>
 <thead>
  <tr>
   <th style="text-align:left;">  </th>
   <th style="text-align:left;"> d_click_don_link </th>
   <th style="text-align:left;">  </th>
   <th style="text-align:left;">  </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> treat_emotion </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:left;"> NA_ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 97.5% (1376) </td>
   <td style="text-align:left;"> 2.1% (29) </td>
   <td style="text-align:left;"> 0.5% (7) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 94.6% (1134) </td>
   <td style="text-align:left;"> 4.7% (56) </td>
   <td style="text-align:left;"> 0.8% (9) </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>If this is our metric, it only seems fair to take into account ‘whether they opened the email’ as part of this effect. Thus, considering clicks as a share of <em>total emails sent</em>…</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  click_don_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_click_don_link, assigned_emails,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cred.mass =</span> <span class="fl">0.95</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Bayesian First Aid proportion test

data: oc_mat_r$tot_d_click_don_link out of assigned_emails
number of successes:    29,   56
number of trials:     2000, 2000
Estimated relative frequency of success [95% credible interval]:
  Group 1: 0.015 [0.0098, 0.020]
  Group 2: 0.028 [0.021, 0.036]
Estimated group difference (Group 1 - Group 2):
  -0.01 [-0.023, -0.0046]
The relative frequency of success is larger for Group 1 by a probability
of 0.002 and larger for Group 2 by a probability of 0.998 .</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(click_don_by_treat_opened_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>don_click_by_treat_all_AB</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_click_don_link), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(assigned_emails))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_assigned <span class="ot">&lt;-</span> oftw_mc_db_assigned <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(d_click_don_link))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_click_by_treat_all_AB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/don_click_by_treat_all_AB-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/don_click_by_treat_all_AB-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/don_click_by_treat_all_AB-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>don_click_by_treat_all_AB</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_click_by_treat_all_AB_empir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/don_click_by_treat_all_AB-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/don_click_by_treat_all_AB-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/don_click_by_treat_all_AB-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>don_click_by_treat_all_AB</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Quantiles of posteriors for A and B:

$Probability
$Probability$A
         0%         25%         50%         75%        100% 
0.005613925 0.013111564 0.014855512 0.016785020 0.030921759 

$Probability$B
        0%        25%        50%        75%       100% 
0.01457222 0.02602580 0.02846221 0.03102267 0.04764887 


--------------------------------------------

P(A &gt; B) by (0)%: 

$Probability
[1] 0.00155

--------------------------------------------

Credible Interval on (A - B) / B for interval length(s) (0.9) : 

$Probability
        5%        95% 
-0.6412379 -0.2472723 

--------------------------------------------

Posterior Expected Loss for choosing A over B:

$Probability
[1] 0.9686057</code></pre>
</div>
<details>
<summary>don_click_by_treat_all_AB</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB_lift_int80 <span class="ot">&lt;-</span> don_click_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB_lift_int80_empir <span class="ot">&lt;-</span> don_click_by_treat_all_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>80% credible intervals with the uniform prior for the ‘lift’ of Impact relative to Emotion are</p>
<p>-0.610, -0.304</p>
<p>and for the empirically informed (but symmetric prior):</p>
<p>-0.3119, -0.0531</p>
<p>(Hard-coded)</p>
<p>There is fairly strong evidence that the emotion email lead to a higher rate of clicks on the donation link; note that this even is <em>in spite of</em> the lower rate of email opens.</p>
<p>This suggests (IMO) it is worth testing this further.</p>
</section>
<section id="redoing-a-bunch-of-stuff-manually" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="redoing-a-bunch-of-stuff-manually"><span class="header-section-number">4.6.2</span> Redoing a bunch of stuff manually</h3>
<p>First, some building blocks;</p>
<p><em>the probability distribution over the absolute value of differences between two binomial random variables</em></p>
<p><strong>Adapting formulas from <a href="https://math.stackexchange.com/questions/562119/difference-of-two-binomial-random-variables">Stackexchange post</a> discussion</strong></p>
<p>Defining their code for this function:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>modBin <span class="ot">&lt;-</span> dbinom <span class="co">#DR: I just do this renaming here for consistency with the rest ... but the modBin they defined was redundant as it's already built ins</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>diffBin <span class="ot">&lt;-</span> <span class="cf">function</span>(z, n1, p1, n2, p2){</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (z<span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n1){</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>      prob <span class="ot">&lt;-</span> prob <span class="sc">+</span> <span class="fu">modBin</span>(i<span class="sc">+</span>z, n1, p1) <span class="sc">*</span> <span class="fu">modBin</span>(i, n2, p2)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n2){</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>      prob<span class="ot">&lt;-</span>prob<span class="sc">+</span><span class="fu">modBin</span>(i<span class="sc">+</span>z, n1, p1)<span class="sc">*</span><span class="fu">modBin</span>(i, n2, p2)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prob)</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br>
</p>
<p>We generate an alternate version to cover ‘differences in one direction, i.e., but ’probability of observing (d1-d2)/(n1+n2) share more of d1 responses than d2 responses given sample sizes n1 and n2… over a range of true probabilities p1 and p2’</p>
<p><em>the probability distribution for differences between two binomial random variables in one direction</em></p>
<div class="cell">

</div>
<p>For the present case</p>
<p>Hard-coded notes…</p>
<p>::: {.foldable}</p>
<!-- Doing this from the (later: do from data) -->
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">1</span>]</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">2</span>]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_click_don_link[<span class="dv">1</span>]</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_click_don_link[<span class="dv">2</span>]</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> d1<span class="sc">-</span>d2 <span class="co">#impact minus emotion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Computation for a few ‘ad-hoc cases’ (later explore the space with vectors of values)</p>
<ol type="1">
<li>Suppose truly equal incidence, at the mean level</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> (d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  db_0 <span class="ot">&lt;-</span> <span class="fu">diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.963627e-05</code></pre>
</div>
</div>
<p>This implies there is a 0.00396% chance of getting this <em>exact</em> difference of +-27 incidence(s) between the treatments (in one direction), if the true incidence rates were equal.</p>
<p>Let’s plot this for a range of ‘incidence rate differences’ in this region. (Sorry, using the traditional plot, ggplot is better).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">*</span>z, <span class="dv">10</span><span class="sc">*</span>z)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">sapply</span>(s, <span class="cf">function</span>(z) <span class="fu">diffBin</span>(z, n1, p1, n2, p2))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s,p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see a large likelihood of values in the range of the +-27 difference observed, and a low likelihood of a difference of 10 or more in either direction.</p>
</section>
<section id="adaptation-of-this-magnitude-or-smaller" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="adaptation-of-this-magnitude-or-smaller"><span class="header-section-number">4.6.3</span> Adaptation: ‘of this magnitude or smaller’</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ltmag_diffBin <span class="ot">&lt;-</span> <span class="cf">function</span>(z, n1, p1, n2, p2){</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  z_n <span class="ot">&lt;-</span> <span class="sc">-</span>z <span class="co">#negative value</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> z_n<span class="sc">:</span>z){     <span class="co">#sum for all integer differences between observed value and its negative, inclusive</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> prob <span class="sc">+</span> <span class="fu">diffBin</span>(i, n1, p1, n2, p2)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prob)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, a similar computation as above, but for ‘a difference this big or smaller in magnitude’:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    mag_db_0 <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9880585</code></pre>
</div>
</div>
<p>This implies there is a 98.8% chance of getting a difference <em>no larger than this one in magnitude</em> of +/–27 incidences between the treatments if the true incidence rates were equal.</p>
<p><br>
</p>
<p><strong>And finally, what we were looking for:</strong> the chance of ‘a difference this small or smaller’ as a function of the <strong>true difference…</strong></p>
<p>(Think about: should we do this for ‘a difference in the same direction’ instead?)</p>
<p>Set up an arbitrary vector of ‘true differences’ <!-- (to keep it simple, only change it in one direction for now ...) --></p>
<p>Below, I plot</p>
<p>Y-axis: ’how likely would be a difference in donations ‘as small or smaller in magnitude’” than we see in the data against…</p>
<p>X-axis: if the “true difference in incidence rates” were of these magnitudes</p>
<p>(Note: this should cover ‘a difference in either direction’; the probability of a difference in the direction we <em>do</em> see is obviously somewhat smaller)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rep</span>((d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2), <span class="fu">length</span>(B))</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1<span class="sc">*</span>B</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(<span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">digits=</span><span class="dv">3</span>, <span class="at">scientific=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "98.8"   "93.2"   "33.6"   "1.81"   "0.0157"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>probmag <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co">#qplot(B, probmag, log  = "x", xlab = "True relative incidence", ylab ="Prob. of difference this small")</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  probmag_plot <span class="ot">&lt;-</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>B, <span class="at">y=</span>probmag) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"True relative incidence rate"</span>) <span class="sc">+</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Prob. diff. as small as obsd"</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Hard-coded takeaways 15 Dec 2021 :</p>
<p>Our data is consistent with ‘no difference’ (of course) … but its also consistent with ‘a fairly large difference in incidence’</p>
<p>E.g., even if one treatment truly lead to ‘twice as many donations as the other’, we still have a 20% chance of seeing a differences as small as the one we see (of 8 versus 6)</p>
<p>We can reasonably ‘rule out’ differences of maybe 2.5x or greater</p>
<p>Main point: given the rareness of donations in this context, our sample size doesn’t let us make very strong conclusions in either directions … at least not yet. I hope that combined with other evidence, we will be able to infer more</p>
</section>
<section id="quick-redo-assuming-equal-shares-recieved-each-email-and-treating-email-reciepts-as-denom" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="quick-redo-assuming-equal-shares-recieved-each-email-and-treating-email-reciepts-as-denom"><span class="header-section-number">4.6.4</span> Quick redo assuming equal shares recieved each email, and treating ‘email reciepts as denom’</h3>
<p>Approx 4000 total emails sent?</p>
<p>For squarespace</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> d1<span class="sc">-</span>d2</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">2.5</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rep</span>((d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2), <span class="fu">length</span>(B))</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1<span class="sc">*</span>B</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    mag_db_0_ss <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.071197896 0.100275616 0.147727269 0.220724651 0.272100392 0.154218060
[7] 0.046306831 0.009174658 0.001345637</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>probmag_ss <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  probmag_plot_ss <span class="ot">&lt;-</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>B, <span class="at">y=</span>probmag_ss) <span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,.<span class="dv">51</span>) <span class="sc">+</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"True relative incidence rate"</span>) <span class="sc">+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Prob. diff. as small as obsd"</span>)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="oftw_upsell_input_first_analysis_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#note that it is not symmetric bc (I think) a very low incidence on one side makes particular large observed proportional differences more likely</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For all one-time donations</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> d1<span class="sc">-</span>d2</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">2.5</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rep</span>((d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2), <span class="fu">length</span>(B))</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1<span class="sc">*</span>B</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    mag_db_0 <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0922168538 0.1395427545 0.2249330548 0.3745240308 0.5032003013
[6] 0.2505329859 0.0521354769 0.0059810731 0.0004413855</code></pre>
</div>
</div>
<p>(the below halts on build, so I commented it out)</p>
<div class="cell">
<details>
<summary>probmag_plot_ot</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  probmag_plot_ot <span class="ot">&lt;-</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>B, <span class="at">y=</span>probmag) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,.<span class="dv">51</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"True relative incidence rate"</span>) <span class="sc">+</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Prob. diff. as small as obsd"</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="demographics-and-interactions-to-do" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="demographics-and-interactions-to-do"><span class="header-section-number">4.7</span> Demographics and interactions (to do)</h2>


<!-- -->

</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Setup at top installs/loads packages.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Todo for best practice in future: more direct input through API tools; package bigrquery for bitquery.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>We could and should do a great deal of this. We should present the results relevant to this trial in specific here. Elsewhere we can do a deeper dive into OftW data in a general sense.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/gwwc_pledge_wip.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">(GWWC: Pledge page trial)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/tlycs_input_simple_analysis.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">TLYCS Portland trial: Brief report</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb83" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># OftW pre-GT-email upsell (impact/emotion) {#oftw_pregt}</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>OftW pre-giving-tuesday-email upselling split test (considering 'impact vs emotion') c</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>^<span class="co">[</span><span class="ot">Setup at top installs/loads packages.</span><span class="co">]</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"code"</span>, <span class="st">"shared_packages_code.R"</span>))</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## The trial</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>In December 2021, <span class="co">[</span><span class="ot">One For the World</span><span class="co">](https://www.1fortheworld.org/)</span> (OftW) sent out a sequence of emails to existing OftW pledgers/participants asking them for an additional donation. There were two 'treatment variants'; an emotional email and a standard impact-based email. The treatment was constant by individual (the same person always got emails with the same theme).</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>The details are presented in our gitbook <span class="co">[</span><span class="ot">HERE</span><span class="co">](https://effective-giving-marketing.gitbook.io/untitled/contexts-partner-organizations-trials/one-for-the-world-oftw/pre-giving-tuesday-email-split-test-+)</span> and in the preregistration linked within (also on OSF).</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Capturing data</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>Kennan and Chloe captured the data and metadata from</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The OFTW database</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>SurveyMonkey</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>Putting this into the (private) Google sheet linked <span class="co">[</span><span class="ot">HERE</span><span class="co">](https://docs.google.com/spreadsheets/d/1iUKXkEqoadBgtUG_epBzUzCgA_J5mdWWstcXtpAdNJs/edit#gid=521638649)</span>.</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>We added some metadata/explainers to that data.^<span class="co">[</span><span class="ot">Todo for best practice in future: more direct input through API tools; package bigrquery for bitquery.</span><span class="co">]</span></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- (This is gitignored so it won't be 'committed' to our repo, at least for now)</span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a><span class="co">Quick note here on how Kennan put the (different types of) data together in that Gsheet. We probably should use the API tool to import it directly here. --&gt;</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Input and clean data</span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>We input the sheets from the external Google sheet location (access required)...</span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r , warning=FALSE, message=FALSE}</span></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: oftw_21_22_mc</span></span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "oftw_21_22_mc"</span></span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a><span class="fu">gs4_auth</span>(<span class="at">scope =</span> <span class="st">"https://www.googleapis.com/auth/drive"</span>)</span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a><span class="fu">drive_auth</span>(<span class="at">token =</span> <span class="fu">gs4_token</span>())</span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Mailchimp data</span></span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc <span class="ot">&lt;-</span> <span class="fu">read_sheet</span>(<span class="st">"https://docs.google.com/spreadsheets/d/1iUKXkEqoadBgtUG_epBzUzCgA_J5mdWWstcXtpAdNJs/edit#gid=521638649"</span>,</span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet=</span><span class="st">"Raw data (Mailchimp)"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Treatment group</span><span class="st">`</span>) <span class="sc">%&gt;%</span>  <span class="co">#remove an un-useful repeated name column</span></span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Treatment Group</span><span class="st">`</span> <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(<span class="st">`</span><span class="at">Treatment Group</span><span class="st">`</span>, <span class="sc">~</span> .[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Email Address</span><span class="st">`</span>, <span class="st">`</span><span class="at">Email Date</span><span class="st">`</span>, <span class="st">`</span><span class="at">Treatment Group</span><span class="st">`</span>, Opens, <span class="st">`</span><span class="at">Donate link clicks</span><span class="st">`</span>, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> <span class="co">#Most relevant features organized first</span></span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">Email Address</span><span class="st">`</span>)</span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a><span class="co">#later: remove features brought in from OFTW database, reconstruct it</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse=</span><span class="st">", "</span>)</span>
<span id="cb83-60"><a href="#cb83-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-61"><a href="#cb83-61" aria-hidden="true" tabindex="-1"></a><span class="co">#...input descriptors for the above (do this later from "doc: ...Mailchimp" sheet</span></span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-63"><a href="#cb83-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-64"><a href="#cb83-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-65"><a href="#cb83-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r , warning=FALSE, message=FALSE}</span></span>
<span id="cb83-66"><a href="#cb83-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: oftw_21_22_db_don</span></span>
<span id="cb83-67"><a href="#cb83-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "oftw_21_22_db_don"</span></span>
<span id="cb83-68"><a href="#cb83-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-69"><a href="#cb83-69" aria-hidden="true" tabindex="-1"></a><span class="co">#Donations data (and OftW database info)</span></span>
<span id="cb83-70"><a href="#cb83-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-71"><a href="#cb83-71" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="ot">&lt;-</span> <span class="fu">read_sheet</span>(</span>
<span id="cb83-72"><a href="#cb83-72" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://docs.google.com/spreadsheets/d/1iUKXkEqoadBgtUG_epBzUzCgA_J5mdWWstcXtpAdNJs/edit#gid=521638649"</span>,</span>
<span id="cb83-73"><a href="#cb83-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet=</span><span class="st">"Giving Season contributions (BigQuery)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-74"><a href="#cb83-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Treatment group</span><span class="st">`</span> <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(<span class="st">`</span><span class="at">Treatment group</span><span class="st">`</span>, <span class="sc">~</span> .[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb83-75"><a href="#cb83-75" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">email</span><span class="st">`</span>, <span class="st">`</span><span class="at">primary_email</span><span class="st">`</span>, <span class="st">`</span><span class="at">donation_date</span><span class="st">`</span>, <span class="st">`</span><span class="at">Net_Contribution_Amount_USD</span><span class="st">`</span>, <span class="st">`</span><span class="at">payment_platform</span><span class="st">`</span>, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span>  <span class="co">#Most relevant features organized first</span></span>
<span id="cb83-76"><a href="#cb83-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(donation_date<span class="sc">&gt;=</span><span class="fu">as.Date</span>(<span class="st">"2021-11-15"</span>)) <span class="co"># At least for now, remove pre-treatment donation data</span></span>
<span id="cb83-77"><a href="#cb83-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-78"><a href="#cb83-78" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse=</span><span class="st">", "</span>)</span>
<span id="cb83-79"><a href="#cb83-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-80"><a href="#cb83-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-81"><a href="#cb83-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-82"><a href="#cb83-82" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb83-83"><a href="#cb83-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-84"><a href="#cb83-84" aria-hidden="true" tabindex="-1"></a><span class="co">For the first question, we'll need to transform the contribution data to look at how many contributions came from people in each group who actually opened the emails (Column D) and then further subset it to just website donations (ie Column I = "Squarespace").</span></span>
<span id="cb83-85"><a href="#cb83-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-86"><a href="#cb83-86" aria-hidden="true" tabindex="-1"></a><span class="co">For the second, I just updated the formulas in both of those columns. Remember that, since the Raw Data (Mailchimp) tab holds one observation for each email-open by a given donor, an individual donor may appear up to five times. Accordingly, summing these aggregated columns will vastly inflate the totals. We may be better off making a unique() call to the emails and constructing a donor-level dataset separately. Happy to talk more tomorrow (or next week if those times don't work).</span></span>
<span id="cb83-87"><a href="#cb83-87" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb83-88"><a href="#cb83-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-89"><a href="#cb83-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-90"><a href="#cb83-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-91"><a href="#cb83-91" aria-hidden="true" tabindex="-1"></a><span class="fu">### Labeling and cleaning</span></span>
<span id="cb83-92"><a href="#cb83-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-93"><a href="#cb83-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-94"><a href="#cb83-94" aria-hidden="true" tabindex="-1"></a>The code ...</span>
<span id="cb83-95"><a href="#cb83-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-96"><a href="#cb83-96" aria-hidden="true" tabindex="-1"></a>...makes names <span class="in">`snake_case`</span>, using original names as labels...</span>
<span id="cb83-97"><a href="#cb83-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-100"><a href="#cb83-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-101"><a href="#cb83-101" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(oftw_21_22_mc) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_21_22_mc)</span>
<span id="cb83-102"><a href="#cb83-102" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(oftw_21_22_mc) <span class="ot">&lt;-</span> snakecase<span class="sc">::</span><span class="fu">to_snake_case</span>(<span class="fu">names</span>(oftw_21_22_mc))</span>
<span id="cb83-103"><a href="#cb83-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-104"><a href="#cb83-104" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(oftw_21_22_db_don) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_21_22_db_don)</span>
<span id="cb83-105"><a href="#cb83-105" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(oftw_21_22_db_don) <span class="ot">&lt;-</span> snakecase<span class="sc">::</span><span class="fu">to_snake_case</span>(<span class="fu">names</span>(oftw_21_22_db_don))</span>
<span id="cb83-106"><a href="#cb83-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-107"><a href="#cb83-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-108"><a href="#cb83-108" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--Todo: Remove useless columns --&gt;</span></span>
<span id="cb83-109"><a href="#cb83-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-110"><a href="#cb83-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-111"><a href="#cb83-111" aria-hidden="true" tabindex="-1"></a>...and anonymizes the data, hashing anything with the chance of being identifying</span>
<span id="cb83-112"><a href="#cb83-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-115"><a href="#cb83-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-116"><a href="#cb83-116" aria-hidden="true" tabindex="-1"></a>salty_hash <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb83-117"><a href="#cb83-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">salt</span>(<span class="at">.seed =</span> <span class="dv">42</span>, x) <span class="sc">%&gt;%</span> <span class="fu">hash</span>(<span class="at">.algo =</span> <span class="st">"crc32"</span>)</span>
<span id="cb83-118"><a href="#cb83-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-119"><a href="#cb83-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-120"><a href="#cb83-120" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc <span class="ot">&lt;-</span> oftw_21_22_mc <span class="sc">%&gt;%</span></span>
<span id="cb83-121"><a href="#cb83-121" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>first_name, <span class="sc">-</span>last_name) <span class="sc">%&gt;%</span></span>
<span id="cb83-122"><a href="#cb83-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(email_address,  employer, school_string), salty_hash))</span>
<span id="cb83-123"><a href="#cb83-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-124"><a href="#cb83-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-125"><a href="#cb83-125" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="ot">&lt;-</span> oftw_21_22_db_don <span class="sc">%&gt;%</span></span>
<span id="cb83-126"><a href="#cb83-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(primary_email, email, school), salty_hash))</span>
<span id="cb83-127"><a href="#cb83-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-128"><a href="#cb83-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-129"><a href="#cb83-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-130"><a href="#cb83-130" aria-hidden="true" tabindex="-1"></a>Roll up to 1 per person; summarize and pivot_wider</span>
<span id="cb83-131"><a href="#cb83-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-132"><a href="#cb83-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb83-133"><a href="#cb83-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rollup</span></span>
<span id="cb83-134"><a href="#cb83-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "rollup"</span></span>
<span id="cb83-135"><a href="#cb83-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-136"><a href="#cb83-136" aria-hidden="true" tabindex="-1"></a>outcomes_base_mc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"opens"</span>, <span class="st">"donate_link_clicks"</span>)</span>
<span id="cb83-137"><a href="#cb83-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-138"><a href="#cb83-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-139"><a href="#cb83-139" aria-hidden="true" tabindex="-1"></a>oftw_21_22_mc_wide <span class="ot">&lt;-</span> oftw_21_22_mc <span class="sc">%&gt;%</span></span>
<span id="cb83-140"><a href="#cb83-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treat_emotion =</span> <span class="fu">case_when</span>(</span>
<span id="cb83-141"><a href="#cb83-141" aria-hidden="true" tabindex="-1"></a>    treatment_group <span class="sc">==</span> <span class="st">"1.000000"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb83-142"><a href="#cb83-142" aria-hidden="true" tabindex="-1"></a>    treatment_group <span class="sc">==</span> <span class="st">"2.000000"</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb83-143"><a href="#cb83-143" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb83-144"><a href="#cb83-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(email_address) <span class="sc">%&gt;%</span></span>
<span id="cb83-145"><a href="#cb83-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(outcomes_base_mc), sum, <span class="at">.names =</span> <span class="st">"{.col}_tot"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-146"><a href="#cb83-146" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> email_number,</span>
<span id="cb83-147"><a href="#cb83-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">"opens"</span>, <span class="st">"donate_link_clicks"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-148"><a href="#cb83-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_click_don_link =</span> donate_link_clicks_tot <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-149"><a href="#cb83-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(email_address) <span class="sc">%&gt;%</span></span>
<span id="cb83-150"><a href="#cb83-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb83-151"><a href="#cb83-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-152"><a href="#cb83-152" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don <span class="ot">&lt;-</span> oftw_21_22_db_don <span class="sc">%&gt;%</span></span>
<span id="cb83-153"><a href="#cb83-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-154"><a href="#cb83-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(email) <span class="sc">%&gt;%</span></span>
<span id="cb83-155"><a href="#cb83-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb83-156"><a href="#cb83-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">don_tot =</span> <span class="fu">sum</span>(net_contribution_amount_usd),</span>
<span id="cb83-157"><a href="#cb83-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_don =</span> <span class="fu">n</span>(),</span>
<span id="cb83-158"><a href="#cb83-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_don =</span> num_don <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb83-159"><a href="#cb83-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">don_tot_ot =</span> <span class="fu">sum</span>(net_contribution_amount_usd[contribution_frequency <span class="sc">==</span></span>
<span id="cb83-160"><a href="#cb83-160" aria-hidden="true" tabindex="-1"></a>        <span class="st">"One-time"</span>]),</span>
<span id="cb83-161"><a href="#cb83-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_don_ot =</span> <span class="fu">sum</span>(contribution_frequency <span class="sc">==</span> <span class="st">"One-time"</span>),</span>
<span id="cb83-162"><a href="#cb83-162" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_don_ot =</span> num_don_ot <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb83-163"><a href="#cb83-163" aria-hidden="true" tabindex="-1"></a>    <span class="co">#WAIT THIS IS NOT WIDE DATA -- don't interpret it as 'number of individuals'</span></span>
<span id="cb83-164"><a href="#cb83-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">don_tot_ss =</span> <span class="fu">sum</span>(net_contribution_amount_usd[payment_platform <span class="sc">==</span> <span class="st">"Squarespace"</span>]),</span>
<span id="cb83-165"><a href="#cb83-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_don_ss =</span> <span class="fu">sum</span>(payment_platform <span class="sc">==</span> <span class="st">"Squarespace"</span>),</span>
<span id="cb83-166"><a href="#cb83-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_don_ss =</span> num_don_ss <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb83-167"><a href="#cb83-167" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-168"><a href="#cb83-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-169"><a href="#cb83-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-170"><a href="#cb83-170" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don_persons <span class="ot">&lt;-</span> oftw_21_22_db_don <span class="sc">%&gt;%</span></span>
<span id="cb83-171"><a href="#cb83-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(email) <span class="sc">%&gt;%</span></span>
<span id="cb83-172"><a href="#cb83-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)     <span class="sc">%&gt;%</span></span>
<span id="cb83-173"><a href="#cb83-173" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb83-174"><a href="#cb83-174" aria-hidden="true" tabindex="-1"></a>      <span class="at">treat_emotion =</span> <span class="fu">case_when</span>(</span>
<span id="cb83-175"><a href="#cb83-175" aria-hidden="true" tabindex="-1"></a>        treatment_group<span class="sc">==</span><span class="st">"1.000000"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb83-176"><a href="#cb83-176" aria-hidden="true" tabindex="-1"></a>        treatment_group <span class="sc">==</span> <span class="st">"2.000000"</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb83-177"><a href="#cb83-177" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb83-178"><a href="#cb83-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-179"><a href="#cb83-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-180"><a href="#cb83-180" aria-hidden="true" tabindex="-1"></a>oftw_mc_db <span class="ot">&lt;-</span> <span class="fu">power_full_join</span>(oftw_21_22_mc_wide,</span>
<span id="cb83-181"><a href="#cb83-181" aria-hidden="true" tabindex="-1"></a>   oftw_21_22_db_don_persons,  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"email_address"</span> <span class="ot">=</span> <span class="st">"email"</span>), <span class="at">conflict =</span> coalesce_xy) <span class="sc">%&gt;%</span></span>
<span id="cb83-182"><a href="#cb83-182" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_don"</span>), <span class="sc">~</span><span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)), <span class="co">#make it a 0 if it's not in the donation database</span></span>
<span id="cb83-183"><a href="#cb83-183" aria-hidden="true" tabindex="-1"></a>   <span class="at">d_open=</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb83-184"><a href="#cb83-184" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-185"><a href="#cb83-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-186"><a href="#cb83-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-187"><a href="#cb83-187" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_openers <span class="ot">&lt;-</span> oftw_mc_db <span class="sc">%&gt;%</span></span>
<span id="cb83-188"><a href="#cb83-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion))</span>
<span id="cb83-189"><a href="#cb83-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-190"><a href="#cb83-190" aria-hidden="true" tabindex="-1"></a><span class="co"># oftw_21_22_db_don_wide &lt;- oftw_21_22_db_don %&gt;%</span></span>
<span id="cb83-191"><a href="#cb83-191" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(email, donation_date, net_contribution_amount_usd, payment_platform) %&gt;%</span></span>
<span id="cb83-192"><a href="#cb83-192" aria-hidden="true" tabindex="-1"></a><span class="co">#    group_by(email) %&gt;%</span></span>
<span id="cb83-193"><a href="#cb83-193" aria-hidden="true" tabindex="-1"></a><span class="co">#    mutate(row = row_number()) %&gt;%</span></span>
<span id="cb83-194"><a href="#cb83-194" aria-hidden="true" tabindex="-1"></a><span class="co">#       tidyr::pivot_wider(names_from = row, values_from = c("donation_date", "net_contribution_amount_usd"))</span></span>
<span id="cb83-195"><a href="#cb83-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-196"><a href="#cb83-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-197"><a href="#cb83-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-198"><a href="#cb83-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-199"><a href="#cb83-199" aria-hidden="true" tabindex="-1"></a>Prelim results</span>
<span id="cb83-202"><a href="#cb83-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-203"><a href="#cb83-203" aria-hidden="true" tabindex="-1"></a>oftw_mc_db <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don)</span>
<span id="cb83-204"><a href="#cb83-204" aria-hidden="true" tabindex="-1"></a>oftw_mc_db <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don_ss)</span>
<span id="cb83-205"><a href="#cb83-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-206"><a href="#cb83-206" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don_persons <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don_ot)</span>
<span id="cb83-207"><a href="#cb83-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-208"><a href="#cb83-208" aria-hidden="true" tabindex="-1"></a><span class="co">#todo: simple statistical measures along with this</span></span>
<span id="cb83-209"><a href="#cb83-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-210"><a href="#cb83-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-211"><a href="#cb83-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-212"><a href="#cb83-212" aria-hidden="true" tabindex="-1"></a><span class="fu">### Constructing outcome measures, especially  'donations likely driven by email'</span></span>
<span id="cb83-213"><a href="#cb83-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-214"><a href="#cb83-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-215"><a href="#cb83-215" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Donations (presence, count, amounts) in giving seasons, 1 row per user (with treatment etc.)</span>
<span id="cb83-216"><a href="#cb83-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-217"><a href="#cb83-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>overall</span>
<span id="cb83-218"><a href="#cb83-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>non-regular</span>
<span id="cb83-219"><a href="#cb83-219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>'likely from email'</span>
<span id="cb83-220"><a href="#cb83-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-221"><a href="#cb83-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-222"><a href="#cb83-222" aria-hidden="true" tabindex="-1"></a>are in Giving Season contributions (BigQuery)</span>
<span id="cb83-223"><a href="#cb83-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-224"><a href="#cb83-224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>subset for payment platform = squarespace (unlikely to come from any other checkout page)</span>
<span id="cb83-225"><a href="#cb83-225" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>email as primary key, link to <span class="in">`Raw Data (mailchimp)`</span>, filter on 'Donate link clicks`&gt;0</span>
<span id="cb83-226"><a href="#cb83-226" aria-hidden="true" tabindex="-1"></a>(note that one needs aggregating by donor because it is 'per email')</span>
<span id="cb83-227"><a href="#cb83-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-228"><a href="#cb83-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-229"><a href="#cb83-229" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Giving season donations ..</span>
<span id="cb83-230"><a href="#cb83-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-231"><a href="#cb83-231" aria-hidden="true" tabindex="-1"></a>Giving Season contributions (BigQuery), sum donation_date   Net_Contribution_Amount_USD with filters for one-time etc</span>
<span id="cb83-232"><a href="#cb83-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-233"><a href="#cb83-233" aria-hidden="true" tabindex="-1"></a>Can check against fields 'Total Giving Season contributions Total Giving Season contribution amount'</span>
<span id="cb83-234"><a href="#cb83-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-235"><a href="#cb83-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-236"><a href="#cb83-236" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Could make a nested array:</span></span>
<span id="cb83-237"><a href="#cb83-237" aria-hidden="true" tabindex="-1"></a><span class="co">- Dates emails sent, number of clicks per email</span></span>
<span id="cb83-238"><a href="#cb83-238" aria-hidden="true" tabindex="-1"></a><span class="co">- Dates donations made, donation amount --&gt;</span></span>
<span id="cb83-239"><a href="#cb83-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-240"><a href="#cb83-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-243"><a href="#cb83-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-244"><a href="#cb83-244" aria-hidden="true" tabindex="-1"></a><span class="co">#list/matrix of rates for later use</span></span>
<span id="cb83-245"><a href="#cb83-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-246"><a href="#cb83-246" aria-hidden="true" tabindex="-1"></a>oc_mat <span class="ot">&lt;-</span> oftw_mc_db <span class="sc">%&gt;%</span></span>
<span id="cb83-247"><a href="#cb83-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_open=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb83-248"><a href="#cb83-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat_emotion) <span class="sc">%&gt;%</span></span>
<span id="cb83-249"><a href="#cb83-249" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_"</span>), <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"tot_{.col}"</span>))</span>
<span id="cb83-250"><a href="#cb83-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-251"><a href="#cb83-251" aria-hidden="true" tabindex="-1"></a>oc_mat_r <span class="ot">&lt;-</span> oc_mat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion)) <span class="co">#where treatment observed</span></span>
<span id="cb83-252"><a href="#cb83-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-253"><a href="#cb83-253" aria-hidden="true" tabindex="-1"></a>assigned_emails <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2000</span>) <span class="co">#I was told that about 4000 emails were sent, 2000 to each group</span></span>
<span id="cb83-254"><a href="#cb83-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-255"><a href="#cb83-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-256"><a href="#cb83-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-257"><a href="#cb83-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-258"><a href="#cb83-258" aria-hidden="true" tabindex="-1"></a><span class="fu">## Descriptives and exploratory analysis</span></span>
<span id="cb83-259"><a href="#cb83-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-260"><a href="#cb83-260" aria-hidden="true" tabindex="-1"></a>Notes:^<span class="co">[</span><span class="ot">We could and should do a great deal of this. We should present the results relevant to this trial in specific here. Elsewhere we can do a deeper dive into OftW data in a general sense.</span><span class="co">]</span></span>
<span id="cb83-261"><a href="#cb83-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-262"><a href="#cb83-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-263"><a href="#cb83-263" aria-hidden="true" tabindex="-1"></a><span class="fu">### Donation and outcome summary statistics, by treatment</span></span>
<span id="cb83-264"><a href="#cb83-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-265"><a href="#cb83-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-266"><a href="#cb83-266" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic tests: Donation incidence and amounts</span></span>
<span id="cb83-267"><a href="#cb83-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-268"><a href="#cb83-268" aria-hidden="true" tabindex="-1"></a>(See preregistration -- go through preregistered tests one at a time. Note that given the observed conversion rates I do not expect any 'significant differences'.)</span>
<span id="cb83-269"><a href="#cb83-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-270"><a href="#cb83-270" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic tests: Clicks and retention outcomes</span></span>
<span id="cb83-271"><a href="#cb83-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-272"><a href="#cb83-272" aria-hidden="true" tabindex="-1"></a>I'm following the approach discussed in the 'RP methods discussion' under <span class="co">[</span><span class="ot">"Significance and equivalence testing" with randomization inference/simulation; building to Bayes</span><span class="co">]()</span></span>
<span id="cb83-273"><a href="#cb83-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-274"><a href="#cb83-274" aria-hidden="true" tabindex="-1"></a>We see a 'small difference' between treatment groups and it is 'not significant in standard tests' (tests not shown here yet). But can we put meaningful bounds on this? Can we statistically 'rule out large effects'?</span>
<span id="cb83-275"><a href="#cb83-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-276"><a href="#cb83-276" aria-hidden="true" tabindex="-1"></a>(This parallels the analysis done in  <span class="co">[</span><span class="ot">HERE</span><span class="co">](https://rethinkpriorities.github.io/methodology-statistics-design/inference-and-rough-equivalence-testing-with-binomial-outcomes.html#how-likely-are-proportions-this-similar-under-different-size-true-effect-sizes)</span>, which includes some further explanation of the methods)</span>
<span id="cb83-277"><a href="#cb83-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-278"><a href="#cb83-278" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-279"><a href="#cb83-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-280"><a href="#cb83-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-281"><a href="#cb83-281" aria-hidden="true" tabindex="-1"></a><span class="fu">###  Difference between two binomial random variables: Bayesian binomial test</span></span>
<span id="cb83-282"><a href="#cb83-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-283"><a href="#cb83-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-284"><a href="#cb83-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb83-285"><a href="#cb83-285" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fill-in-data</span></span>
<span id="cb83-286"><a href="#cb83-286" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "fill-in-data"</span></span>
<span id="cb83-287"><a href="#cb83-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-288"><a href="#cb83-288" aria-hidden="true" tabindex="-1"></a><span class="co">#would need to generate 'fill in data' if we want to use bayesAB, which requires actual vectors</span></span>
<span id="cb83-289"><a href="#cb83-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-290"><a href="#cb83-290" aria-hidden="true" tabindex="-1"></a><span class="co">#add blank rows for 'assigned'</span></span>
<span id="cb83-291"><a href="#cb83-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-292"><a href="#cb83-292" aria-hidden="true" tabindex="-1"></a>blank_impact <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> assigned_emails[<span class="dv">1</span>]<span class="sc">-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">1</span>], <span class="at">ncol =</span> <span class="fu">NCOL</span>(oftw_mc_db)))</span>
<span id="cb83-293"><a href="#cb83-293" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(blank_impact) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_mc_db)</span>
<span id="cb83-294"><a href="#cb83-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-295"><a href="#cb83-295" aria-hidden="true" tabindex="-1"></a>blank_impact <span class="sc">%&lt;&gt;%</span></span>
<span id="cb83-296"><a href="#cb83-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_"</span>), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb83-297"><a href="#cb83-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat_emotion=</span><span class="dv">0</span>)</span>
<span id="cb83-298"><a href="#cb83-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-299"><a href="#cb83-299" aria-hidden="true" tabindex="-1"></a>blank_emotion <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> assigned_emails[<span class="dv">1</span>]<span class="sc">-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">2</span>], <span class="at">ncol =</span> <span class="fu">NCOL</span>(oftw_mc_db)))</span>
<span id="cb83-300"><a href="#cb83-300" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(blank_emotion) <span class="ot">&lt;-</span> <span class="fu">names</span>(oftw_mc_db)</span>
<span id="cb83-301"><a href="#cb83-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-302"><a href="#cb83-302" aria-hidden="true" tabindex="-1"></a>blank_emotion <span class="sc">%&lt;&gt;%</span></span>
<span id="cb83-303"><a href="#cb83-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"d_"</span>), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb83-304"><a href="#cb83-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat_emotion=</span><span class="dv">1</span>)</span>
<span id="cb83-305"><a href="#cb83-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-306"><a href="#cb83-306" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_assigned <span class="ot">&lt;-</span></span>
<span id="cb83-307"><a href="#cb83-307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(oftw_mc_db, blank_impact, blank_emotion) <span class="sc">%&gt;%</span></span>
<span id="cb83-308"><a href="#cb83-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion))</span>
<span id="cb83-309"><a href="#cb83-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-310"><a href="#cb83-310" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_assigned <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion)</span>
<span id="cb83-311"><a href="#cb83-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-312"><a href="#cb83-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-313"><a href="#cb83-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-314"><a href="#cb83-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-315"><a href="#cb83-315" aria-hidden="true" tabindex="-1"></a>Opens by treatment:</span>
<span id="cb83-316"><a href="#cb83-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-319"><a href="#cb83-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-320"><a href="#cb83-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Following r https://www.sumsar.net/blog/2014/06/bayesian-first-aid-prop-test/</span></span>
<span id="cb83-321"><a href="#cb83-321" aria-hidden="true" tabindex="-1"></a><span class="co"># alt: http://frankportman.github.io/bayesAB/</span></span>
<span id="cb83-322"><a href="#cb83-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-323"><a href="#cb83-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-324"><a href="#cb83-324" aria-hidden="true" tabindex="-1"></a><span class="co">#opens_by_treat_fit &lt;- bayes.prop.test(oc_mat_r$tot_d_open, assigned_emails, cred.mass = 0.95) #here I highlight the 95% bounds because it's a strong effect!</span></span>
<span id="cb83-325"><a href="#cb83-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-326"><a href="#cb83-326" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(opens_by_treat_fit)</span></span>
<span id="cb83-327"><a href="#cb83-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-328"><a href="#cb83-328" aria-hidden="true" tabindex="-1"></a>unif_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">'beta'</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb83-329"><a href="#cb83-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-330"><a href="#cb83-330" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(assigned_emails))</span>
<span id="cb83-331"><a href="#cb83-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-332"><a href="#cb83-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-333"><a href="#cb83-333" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb83-334"><a href="#cb83-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb83-335"><a href="#cb83-335" aria-hidden="true" tabindex="-1"></a>opens_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-336"><a href="#cb83-336" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-337"><a href="#cb83-337" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-338"><a href="#cb83-338" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb83-339"><a href="#cb83-339" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-340"><a href="#cb83-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-341"><a href="#cb83-341" aria-hidden="true" tabindex="-1"></a>opens_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-342"><a href="#cb83-342" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-343"><a href="#cb83-343" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_open[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-344"><a href="#cb83-344" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb83-345"><a href="#cb83-345" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-346"><a href="#cb83-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-347"><a href="#cb83-347" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(opens_by_treat_AB)</span>
<span id="cb83-348"><a href="#cb83-348" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(opens_by_treat_AB_empir)</span>
<span id="cb83-349"><a href="#cb83-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-350"><a href="#cb83-350" aria-hidden="true" tabindex="-1"></a><span class="co">#WTF -- I need to advance this by command prompt!?</span></span>
<span id="cb83-351"><a href="#cb83-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-352"><a href="#cb83-352" aria-hidden="true" tabindex="-1"></a><span class="co">#AB1 &lt;- bayesTest(oftw_21_22_db_don_persons$d_don_ot[trea], B_binom, priors = c('alpha' = 65, 'beta' = 200), n_samples = 1e5, distribution = 'bernoulli')</span></span>
<span id="cb83-353"><a href="#cb83-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-354"><a href="#cb83-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-355"><a href="#cb83-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-356"><a href="#cb83-356" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-357"><a href="#cb83-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-358"><a href="#cb83-358" aria-hidden="true" tabindex="-1"></a>'Some donation' by treatment (only for those who opened, otherwise donations are surely undercounted for Emotion treatment)</span>
<span id="cb83-359"><a href="#cb83-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-362"><a href="#cb83-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-363"><a href="#cb83-363" aria-hidden="true" tabindex="-1"></a>oftw_21_22_db_don_persons <span class="sc">%&gt;%</span> <span class="fu">tabyl</span>(treat_emotion, d_don)</span>
<span id="cb83-364"><a href="#cb83-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-365"><a href="#cb83-365" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open))</span>
<span id="cb83-366"><a href="#cb83-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-367"><a href="#cb83-367" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-368"><a href="#cb83-368" aria-hidden="true" tabindex="-1"></a>  don_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don, oc_mat_r<span class="sc">$</span>tot_d_open, <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb83-369"><a href="#cb83-369" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-370"><a href="#cb83-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-371"><a href="#cb83-371" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_by_treat_opened_fit)</span>
<span id="cb83-372"><a href="#cb83-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-373"><a href="#cb83-373" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb83-374"><a href="#cb83-374" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb83-375"><a href="#cb83-375" aria-hidden="true" tabindex="-1"></a>don_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-376"><a href="#cb83-376" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-377"><a href="#cb83-377" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-378"><a href="#cb83-378" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb83-379"><a href="#cb83-379" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-380"><a href="#cb83-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-381"><a href="#cb83-381" aria-hidden="true" tabindex="-1"></a>don_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-382"><a href="#cb83-382" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-383"><a href="#cb83-383" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-384"><a href="#cb83-384" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb83-385"><a href="#cb83-385" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-386"><a href="#cb83-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-387"><a href="#cb83-387" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_by_treat_AB)</span>
<span id="cb83-388"><a href="#cb83-388" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_by_treat_AB_empir)</span>
<span id="cb83-389"><a href="#cb83-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-390"><a href="#cb83-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-391"><a href="#cb83-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-392"><a href="#cb83-392" aria-hidden="true" tabindex="-1"></a>Thus we put 80% probability on the difference between the donation rates being no more than (hard-coded) .023/.19 = 12% in either direction. Note that this is not terribly narrowly bounded.</span>
<span id="cb83-393"><a href="#cb83-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-394"><a href="#cb83-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-395"><a href="#cb83-395" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-396"><a href="#cb83-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-397"><a href="#cb83-397" aria-hidden="true" tabindex="-1"></a>*Next, for one-time donations only; again as a share of opens*</span>
<span id="cb83-398"><a href="#cb83-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-401"><a href="#cb83-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-402"><a href="#cb83-402" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-403"><a href="#cb83-403" aria-hidden="true" tabindex="-1"></a>  don_ot_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ot, oc_mat_r<span class="sc">$</span>tot_d_open, <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb83-404"><a href="#cb83-404" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-405"><a href="#cb83-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-406"><a href="#cb83-406" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ot), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open))</span>
<span id="cb83-407"><a href="#cb83-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-408"><a href="#cb83-408" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb83-409"><a href="#cb83-409" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb83-410"><a href="#cb83-410" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-411"><a href="#cb83-411" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-412"><a href="#cb83-412" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-413"><a href="#cb83-413" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb83-414"><a href="#cb83-414" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-415"><a href="#cb83-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-416"><a href="#cb83-416" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-417"><a href="#cb83-417" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-418"><a href="#cb83-418" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ot[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-419"><a href="#cb83-419" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb83-420"><a href="#cb83-420" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-421"><a href="#cb83-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-422"><a href="#cb83-422" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ot_by_treat_AB)</span>
<span id="cb83-423"><a href="#cb83-423" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ot_by_treat_AB_empir)</span>
<span id="cb83-424"><a href="#cb83-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-425"><a href="#cb83-425" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span>
<span id="cb83-426"><a href="#cb83-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-427"><a href="#cb83-427" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB_lift_int80 <span class="ot">&lt;-</span> don_ot_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-428"><a href="#cb83-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-429"><a href="#cb83-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-430"><a href="#cb83-430" aria-hidden="true" tabindex="-1"></a>don_ot_by_treat_AB_lift_int80_empir <span class="ot">&lt;-</span> don_ot_by_treat_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-431"><a href="#cb83-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-432"><a href="#cb83-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-433"><a href="#cb83-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-434"><a href="#cb83-434" aria-hidden="true" tabindex="-1"></a>80% credible intervals with the uniform prior for the 'lift' of Impact relative to Emotion are</span>
<span id="cb83-435"><a href="#cb83-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-436"><a href="#cb83-436" aria-hidden="true" tabindex="-1"></a><span class="in">`r op(don_ot_by_treat_AB_lift_int80$interval$Probability)`</span></span>
<span id="cb83-437"><a href="#cb83-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-438"><a href="#cb83-438" aria-hidden="true" tabindex="-1"></a>and for the empirically informed (but symmetric prior):</span>
<span id="cb83-439"><a href="#cb83-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-440"><a href="#cb83-440" aria-hidden="true" tabindex="-1"></a><span class="in">`r op(don_ot_by_treat_AB_lift_int80_empir$interval$Probability)`</span></span>
<span id="cb83-441"><a href="#cb83-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-442"><a href="#cb83-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-443"><a href="#cb83-443" aria-hidden="true" tabindex="-1"></a>(Hard-coded) Here there is just a trace of suggestive evidence that the emotion treatment performed worse. But even our 80% bounds are very wide.</span>
<span id="cb83-444"><a href="#cb83-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-445"><a href="#cb83-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-446"><a href="#cb83-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-447"><a href="#cb83-447" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-448"><a href="#cb83-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-449"><a href="#cb83-449" aria-hidden="true" tabindex="-1"></a>*For 'Squarespace donations only'; these are the donations that plausibly came from the email. First as a share of opens for each treatment :*</span>
<span id="cb83-450"><a href="#cb83-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-453"><a href="#cb83-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-454"><a href="#cb83-454" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_open))</span>
<span id="cb83-455"><a href="#cb83-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-456"><a href="#cb83-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-457"><a href="#cb83-457" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-458"><a href="#cb83-458" aria-hidden="true" tabindex="-1"></a>  don_ss_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss, oc_mat_r<span class="sc">$</span>tot_d_open, <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb83-459"><a href="#cb83-459" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-460"><a href="#cb83-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-461"><a href="#cb83-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-462"><a href="#cb83-462" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb83-463"><a href="#cb83-463" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb83-464"><a href="#cb83-464" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-465"><a href="#cb83-465" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-466"><a href="#cb83-466" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-467"><a href="#cb83-467" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb83-468"><a href="#cb83-468" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-469"><a href="#cb83-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-470"><a href="#cb83-470" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-471"><a href="#cb83-471" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-472"><a href="#cb83-472" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_openers<span class="sc">$</span>d_don_ss[oftw_mc_db_openers<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-473"><a href="#cb83-473" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb83-474"><a href="#cb83-474" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-475"><a href="#cb83-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-476"><a href="#cb83-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-477"><a href="#cb83-477" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_AB)</span>
<span id="cb83-478"><a href="#cb83-478" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_AB_empir)</span>
<span id="cb83-479"><a href="#cb83-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-480"><a href="#cb83-480" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span>
<span id="cb83-481"><a href="#cb83-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-482"><a href="#cb83-482" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB_lift_int80 <span class="ot">&lt;-</span> don_ss_by_treat_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-483"><a href="#cb83-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-484"><a href="#cb83-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-485"><a href="#cb83-485" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_AB_lift_int80_empir <span class="ot">&lt;-</span> don_ss_by_treat_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-486"><a href="#cb83-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-487"><a href="#cb83-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-488"><a href="#cb83-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-489"><a href="#cb83-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-490"><a href="#cb83-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-491"><a href="#cb83-491" aria-hidden="true" tabindex="-1"></a>80% credible intervals with the uniform prior for the 'lift' of Impact relative to Emotion are</span>
<span id="cb83-492"><a href="#cb83-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-493"><a href="#cb83-493" aria-hidden="true" tabindex="-1"></a><span class="in">`r op(don_ss_by_treat_AB_lift_int80$interval$Probability)`</span></span>
<span id="cb83-494"><a href="#cb83-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-495"><a href="#cb83-495" aria-hidden="true" tabindex="-1"></a>and for the empirically informed (but symmetric prior):</span>
<span id="cb83-496"><a href="#cb83-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-497"><a href="#cb83-497" aria-hidden="true" tabindex="-1"></a><span class="in">`r op(don_ss_by_treat_AB_lift_int80_empir$interval$Probability)`</span></span>
<span id="cb83-498"><a href="#cb83-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-499"><a href="#cb83-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-500"><a href="#cb83-500" aria-hidden="true" tabindex="-1"></a>(Hard-coded) Again, even our 80% bounds are very wide.</span>
<span id="cb83-501"><a href="#cb83-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-502"><a href="#cb83-502" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-503"><a href="#cb83-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-504"><a href="#cb83-504" aria-hidden="true" tabindex="-1"></a>Finally, we consider the above as a share of total emails sent, allowing that  'opens' is non-random,</span>
<span id="cb83-505"><a href="#cb83-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-506"><a href="#cb83-506" aria-hidden="true" tabindex="-1"></a>... and also implicitly assuming that the only impact of these treatments could be on the Squarespace donations made by someone who did open the email.</span>
<span id="cb83-507"><a href="#cb83-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-510"><a href="#cb83-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-511"><a href="#cb83-511" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-512"><a href="#cb83-512" aria-hidden="true" tabindex="-1"></a>  don_ss_by_treat_opened_fit_all <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss, assigned_emails,</span>
<span id="cb83-513"><a href="#cb83-513" aria-hidden="true" tabindex="-1"></a>    <span class="at">cred.mass =</span> <span class="fl">0.80</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb83-514"><a href="#cb83-514" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-515"><a href="#cb83-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-516"><a href="#cb83-516" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb83-517"><a href="#cb83-517" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB package</span></span>
<span id="cb83-518"><a href="#cb83-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-519"><a href="#cb83-519" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_don_ss), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(assigned_emails))</span>
<span id="cb83-520"><a href="#cb83-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-521"><a href="#cb83-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-522"><a href="#cb83-522" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bernoulli test</span></span>
<span id="cb83-523"><a href="#cb83-523" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-524"><a href="#cb83-524" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-525"><a href="#cb83-525" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-526"><a href="#cb83-526" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb83-527"><a href="#cb83-527" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-528"><a href="#cb83-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-529"><a href="#cb83-529" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-530"><a href="#cb83-530" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-531"><a href="#cb83-531" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_don_ss[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-532"><a href="#cb83-532" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb83-533"><a href="#cb83-533" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-534"><a href="#cb83-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-535"><a href="#cb83-535" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_all_AB)</span>
<span id="cb83-536"><a href="#cb83-536" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_ss_by_treat_all_AB_empir)</span>
<span id="cb83-537"><a href="#cb83-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-538"><a href="#cb83-538" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span>
<span id="cb83-539"><a href="#cb83-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-540"><a href="#cb83-540" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB_lift_int80 <span class="ot">&lt;-</span> don_ss_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-541"><a href="#cb83-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-542"><a href="#cb83-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-543"><a href="#cb83-543" aria-hidden="true" tabindex="-1"></a>don_ss_by_treat_all_AB_lift_int80_empir <span class="ot">&lt;-</span> don_ss_by_treat_all_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-544"><a href="#cb83-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-545"><a href="#cb83-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-546"><a href="#cb83-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-547"><a href="#cb83-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-548"><a href="#cb83-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-549"><a href="#cb83-549" aria-hidden="true" tabindex="-1"></a>80% credible intervals with the uniform prior for the 'lift' of Impact relative to Emotion are</span>
<span id="cb83-550"><a href="#cb83-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-553"><a href="#cb83-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-554"><a href="#cb83-554" aria-hidden="true" tabindex="-1"></a> <span class="fu">op</span>(don_ss_by_treat_all_AB_lift_int80<span class="sc">$</span>interval<span class="sc">$</span>Probability)</span>
<span id="cb83-555"><a href="#cb83-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-556"><a href="#cb83-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-557"><a href="#cb83-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-558"><a href="#cb83-558" aria-hidden="true" tabindex="-1"></a>and for the empirically informed (but symmetric prior):</span>
<span id="cb83-559"><a href="#cb83-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-560"><a href="#cb83-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-563"><a href="#cb83-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-564"><a href="#cb83-564" aria-hidden="true" tabindex="-1"></a><span class="fu">op</span>(don_ss_by_treat_all_AB_lift_int80_empir<span class="sc">$</span>interval<span class="sc">$</span>Probability)</span>
<span id="cb83-565"><a href="#cb83-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-566"><a href="#cb83-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-567"><a href="#cb83-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-568"><a href="#cb83-568" aria-hidden="true" tabindex="-1"></a>Hard-coded: Here there is almost no evidence in either direction. However, our 80% credible intervals remain wide.</span>
<span id="cb83-569"><a href="#cb83-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-570"><a href="#cb83-570" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-571"><a href="#cb83-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-572"><a href="#cb83-572" aria-hidden="true" tabindex="-1"></a>Unfortunately, this experiment proved to be underpowered, at least for the donation outcome.</span>
<span id="cb83-573"><a href="#cb83-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-574"><a href="#cb83-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-575"><a href="#cb83-575" aria-hidden="true" tabindex="-1"></a>**But what about clicks on the 'donation link'?** This could arguably be seen as a measure of 'desire and intention to donate', and thus might be a more fine-grained and less noisy measure, improving our statistical power.</span>
<span id="cb83-576"><a href="#cb83-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-577"><a href="#cb83-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-578"><a href="#cb83-578" aria-hidden="true" tabindex="-1"></a>Some quick crosstabs (here as a share of *opens*)</span>
<span id="cb83-579"><a href="#cb83-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-582"><a href="#cb83-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-583"><a href="#cb83-583" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-584"><a href="#cb83-584" aria-hidden="true" tabindex="-1"></a>  donclick_by_treat <span class="ot">&lt;-</span>  oftw_mc_db <span class="sc">%&gt;%</span></span>
<span id="cb83-585"><a href="#cb83-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treat_emotion)) <span class="sc">%&gt;%</span></span>
<span id="cb83-586"><a href="#cb83-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(treat_emotion, d_click_don_link) <span class="sc">%&gt;%</span></span>
<span id="cb83-587"><a href="#cb83-587" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_percentages</span>(<span class="st">"row"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-588"><a href="#cb83-588" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-589"><a href="#cb83-589" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_ns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-590"><a href="#cb83-590" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adorn_title</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-591"><a href="#cb83-591" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span><span class="st">"Click on donation link by treatment; all opened emails"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb83-592"><a href="#cb83-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">"scale_down"</span>)</span>
<span id="cb83-593"><a href="#cb83-593" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-594"><a href="#cb83-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-595"><a href="#cb83-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-596"><a href="#cb83-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-597"><a href="#cb83-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-598"><a href="#cb83-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-599"><a href="#cb83-599" aria-hidden="true" tabindex="-1"></a>If this is our metric, it only seems fair to take into account 'whether they opened the email' as part of this effect. Thus, considering clicks as a share of *total emails sent*...</span>
<span id="cb83-600"><a href="#cb83-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-603"><a href="#cb83-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-604"><a href="#cb83-604" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-605"><a href="#cb83-605" aria-hidden="true" tabindex="-1"></a>  click_don_by_treat_opened_fit <span class="ot">&lt;-</span> <span class="fu">bayes.prop.test</span>(oc_mat_r<span class="sc">$</span>tot_d_click_don_link, assigned_emails,</span>
<span id="cb83-606"><a href="#cb83-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">cred.mass =</span> <span class="fl">0.95</span>) <span class="co"># 80% credible interval for decision-making purposes</span></span>
<span id="cb83-607"><a href="#cb83-607" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-608"><a href="#cb83-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-609"><a href="#cb83-609" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(click_don_by_treat_opened_fit)</span>
<span id="cb83-610"><a href="#cb83-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-611"><a href="#cb83-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-612"><a href="#cb83-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-613"><a href="#cb83-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-614"><a href="#cb83-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-615"><a href="#cb83-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb83-616"><a href="#cb83-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: don_click_by_treat_all_AB</span></span>
<span id="cb83-617"><a href="#cb83-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "don_click_by_treat_all_AB"</span></span>
<span id="cb83-618"><a href="#cb83-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-619"><a href="#cb83-619" aria-hidden="true" tabindex="-1"></a><span class="co">#same with AB  package</span></span>
<span id="cb83-620"><a href="#cb83-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-621"><a href="#cb83-621" aria-hidden="true" tabindex="-1"></a>empir_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'alpha'</span> <span class="ot">=</span> <span class="fu">sum</span>(oc_mat_r<span class="sc">$</span>tot_d_click_don_link), <span class="st">'beta'</span> <span class="ot">=</span> <span class="fu">sum</span>(assigned_emails))</span>
<span id="cb83-622"><a href="#cb83-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-623"><a href="#cb83-623" aria-hidden="true" tabindex="-1"></a>oftw_mc_db_assigned <span class="ot">&lt;-</span> oftw_mc_db_assigned <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(d_click_don_link))</span>
<span id="cb83-624"><a href="#cb83-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-625"><a href="#cb83-625" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit bernoulli test</span></span>
<span id="cb83-626"><a href="#cb83-626" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-627"><a href="#cb83-627" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-628"><a href="#cb83-628" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-629"><a href="#cb83-629" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> unif_prior,</span>
<span id="cb83-630"><a href="#cb83-630" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-631"><a href="#cb83-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-632"><a href="#cb83-632" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB_empir <span class="ot">&lt;-</span> bayesAB<span class="sc">::</span><span class="fu">bayesTest</span>(</span>
<span id="cb83-633"><a href="#cb83-633" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb83-634"><a href="#cb83-634" aria-hidden="true" tabindex="-1"></a>  oftw_mc_db_assigned<span class="sc">$</span>d_click_don_link[oftw_mc_db_assigned<span class="sc">$</span>treat_emotion<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb83-635"><a href="#cb83-635" aria-hidden="true" tabindex="-1"></a>                 <span class="at">priors =</span> empir_prior,</span>
<span id="cb83-636"><a href="#cb83-636" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distribution =</span> <span class="st">'bernoulli'</span>)</span>
<span id="cb83-637"><a href="#cb83-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-638"><a href="#cb83-638" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_click_by_treat_all_AB)</span>
<span id="cb83-639"><a href="#cb83-639" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(don_click_by_treat_all_AB_empir)</span>
<span id="cb83-640"><a href="#cb83-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-641"><a href="#cb83-641" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.9</span>)</span>
<span id="cb83-642"><a href="#cb83-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-643"><a href="#cb83-643" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB_lift_int80 <span class="ot">&lt;-</span> don_click_by_treat_all_AB <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-644"><a href="#cb83-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-645"><a href="#cb83-645" aria-hidden="true" tabindex="-1"></a>don_click_by_treat_all_AB_lift_int80_empir <span class="ot">&lt;-</span> don_click_by_treat_all_AB_empir <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">credInt=</span><span class="fl">0.8</span>)</span>
<span id="cb83-646"><a href="#cb83-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-647"><a href="#cb83-647" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-648"><a href="#cb83-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-649"><a href="#cb83-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-650"><a href="#cb83-650" aria-hidden="true" tabindex="-1"></a>80% credible intervals with the uniform prior for the 'lift' of Impact relative to Emotion are</span>
<span id="cb83-651"><a href="#cb83-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-652"><a href="#cb83-652" aria-hidden="true" tabindex="-1"></a><span class="in">`r op(don_click_by_treat_all_AB_lift_int80$interval$Probability)`</span></span>
<span id="cb83-653"><a href="#cb83-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-654"><a href="#cb83-654" aria-hidden="true" tabindex="-1"></a>and for the empirically informed (but symmetric prior):</span>
<span id="cb83-655"><a href="#cb83-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-656"><a href="#cb83-656" aria-hidden="true" tabindex="-1"></a><span class="in">`r op(don_click_by_treat_all_AB_lift_int80_empir$interval$Probability)`</span></span>
<span id="cb83-657"><a href="#cb83-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-658"><a href="#cb83-658" aria-hidden="true" tabindex="-1"></a>(Hard-coded)</span>
<span id="cb83-659"><a href="#cb83-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-660"><a href="#cb83-660" aria-hidden="true" tabindex="-1"></a>There is fairly strong evidence that the emotion email lead to a higher rate of clicks on the donation link; note that this even is *in spite of* the lower rate of email opens.</span>
<span id="cb83-661"><a href="#cb83-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-662"><a href="#cb83-662" aria-hidden="true" tabindex="-1"></a>This suggests (IMO) it is worth testing this further.</span>
<span id="cb83-663"><a href="#cb83-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-664"><a href="#cb83-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-665"><a href="#cb83-665" aria-hidden="true" tabindex="-1"></a><span class="fu">### Redoing a bunch of stuff manually</span></span>
<span id="cb83-666"><a href="#cb83-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-667"><a href="#cb83-667" aria-hidden="true" tabindex="-1"></a>First, some building blocks;</span>
<span id="cb83-668"><a href="#cb83-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-669"><a href="#cb83-669" aria-hidden="true" tabindex="-1"></a>*the probability distribution over the absolute value of differences between two binomial random variables*</span>
<span id="cb83-670"><a href="#cb83-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-671"><a href="#cb83-671" aria-hidden="true" tabindex="-1"></a>**Adapting formulas from [Stackexchange post](https://math.stackexchange.com/questions/562119/difference-of-two-binomial-random-variables) discussion**</span>
<span id="cb83-672"><a href="#cb83-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-673"><a href="#cb83-673" aria-hidden="true" tabindex="-1"></a>Defining their code for this function:</span>
<span id="cb83-676"><a href="#cb83-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-677"><a href="#cb83-677" aria-hidden="true" tabindex="-1"></a>modBin <span class="ot">&lt;-</span> dbinom <span class="co">#DR: I just do this renaming here for consistency with the rest ... but the modBin they defined was redundant as it's already built ins</span></span>
<span id="cb83-678"><a href="#cb83-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-679"><a href="#cb83-679" aria-hidden="true" tabindex="-1"></a>diffBin <span class="ot">&lt;-</span> <span class="cf">function</span>(z, n1, p1, n2, p2){</span>
<span id="cb83-680"><a href="#cb83-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-681"><a href="#cb83-681" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb83-682"><a href="#cb83-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-683"><a href="#cb83-683" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (z<span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb83-684"><a href="#cb83-684" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n1){</span>
<span id="cb83-685"><a href="#cb83-685" aria-hidden="true" tabindex="-1"></a>      prob <span class="ot">&lt;-</span> prob <span class="sc">+</span> <span class="fu">modBin</span>(i<span class="sc">+</span>z, n1, p1) <span class="sc">*</span> <span class="fu">modBin</span>(i, n2, p2)</span>
<span id="cb83-686"><a href="#cb83-686" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-687"><a href="#cb83-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-688"><a href="#cb83-688" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-689"><a href="#cb83-689" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb83-690"><a href="#cb83-690" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb83-691"><a href="#cb83-691" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n2){</span>
<span id="cb83-692"><a href="#cb83-692" aria-hidden="true" tabindex="-1"></a>      prob<span class="ot">&lt;-</span>prob<span class="sc">+</span><span class="fu">modBin</span>(i<span class="sc">+</span>z, n1, p1)<span class="sc">*</span><span class="fu">modBin</span>(i, n2, p2)</span>
<span id="cb83-693"><a href="#cb83-693" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-694"><a href="#cb83-694" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-695"><a href="#cb83-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prob)</span>
<span id="cb83-696"><a href="#cb83-696" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-697"><a href="#cb83-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-698"><a href="#cb83-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-699"><a href="#cb83-699" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-700"><a href="#cb83-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-701"><a href="#cb83-701" aria-hidden="true" tabindex="-1"></a>We generate an alternate version to cover 'differences in one direction,</span>
<span id="cb83-702"><a href="#cb83-702" aria-hidden="true" tabindex="-1"></a>i.e., but 'probability of observing (d1-d2)/(n1+n2) share more of d1 responses than d2 responses given sample sizes   n1 and n2... over a range of true probabilities p1 and p2'</span>
<span id="cb83-703"><a href="#cb83-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-704"><a href="#cb83-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-705"><a href="#cb83-705" aria-hidden="true" tabindex="-1"></a>*the probability distribution for differences between two binomial random variables in one direction*</span>
<span id="cb83-706"><a href="#cb83-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-709"><a href="#cb83-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-710"><a href="#cb83-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-711"><a href="#cb83-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-712"><a href="#cb83-712" aria-hidden="true" tabindex="-1"></a>For the present case</span>
<span id="cb83-713"><a href="#cb83-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-714"><a href="#cb83-714" aria-hidden="true" tabindex="-1"></a> Hard-coded notes...</span>
<span id="cb83-715"><a href="#cb83-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-716"><a href="#cb83-716" aria-hidden="true" tabindex="-1"></a>::: {.foldable}</span>
<span id="cb83-717"><a href="#cb83-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-718"><a href="#cb83-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-719"><a href="#cb83-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-720"><a href="#cb83-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-721"><a href="#cb83-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-722"><a href="#cb83-722" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Doing this from the (later: do from data) --&gt;</span></span>
<span id="cb83-723"><a href="#cb83-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-724"><a href="#cb83-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-727"><a href="#cb83-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-728"><a href="#cb83-728" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">1</span>]</span>
<span id="cb83-729"><a href="#cb83-729" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_open[<span class="dv">2</span>]</span>
<span id="cb83-730"><a href="#cb83-730" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_click_don_link[<span class="dv">1</span>]</span>
<span id="cb83-731"><a href="#cb83-731" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> oc_mat_r<span class="sc">$</span>tot_d_click_don_link[<span class="dv">2</span>]</span>
<span id="cb83-732"><a href="#cb83-732" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> d1<span class="sc">-</span>d2 <span class="co">#impact minus emotion</span></span>
<span id="cb83-733"><a href="#cb83-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-734"><a href="#cb83-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-735"><a href="#cb83-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-736"><a href="#cb83-736" aria-hidden="true" tabindex="-1"></a>Computation for a few 'ad-hoc cases' (later explore the space with vectors of values)</span>
<span id="cb83-737"><a href="#cb83-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-738"><a href="#cb83-738" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Suppose truly equal incidence, at the mean level</span>
<span id="cb83-739"><a href="#cb83-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-742"><a href="#cb83-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-743"><a href="#cb83-743" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> (d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2)</span>
<span id="cb83-744"><a href="#cb83-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-745"><a href="#cb83-745" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1</span>
<span id="cb83-746"><a href="#cb83-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-747"><a href="#cb83-747" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-748"><a href="#cb83-748" aria-hidden="true" tabindex="-1"></a>  db_0 <span class="ot">&lt;-</span> <span class="fu">diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb83-749"><a href="#cb83-749" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-750"><a href="#cb83-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-751"><a href="#cb83-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-752"><a href="#cb83-752" aria-hidden="true" tabindex="-1"></a>This implies there is a <span class="in">`r op(db_0*100)`</span>% chance of getting this *exact* difference of +<span class="in">`r z`</span> incidence(s) between the treatments (in one direction), if the true incidence rates were equal.</span>
<span id="cb83-753"><a href="#cb83-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-754"><a href="#cb83-754" aria-hidden="true" tabindex="-1"></a>Let's plot this for a range of 'incidence rate differences' in this region. (Sorry, using the traditional plot, ggplot is better).</span>
<span id="cb83-755"><a href="#cb83-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-758"><a href="#cb83-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-759"><a href="#cb83-759" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">*</span>z, <span class="dv">10</span><span class="sc">*</span>z)</span>
<span id="cb83-760"><a href="#cb83-760" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">sapply</span>(s, <span class="cf">function</span>(z) <span class="fu">diffBin</span>(z, n1, p1, n2, p2))</span>
<span id="cb83-761"><a href="#cb83-761" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s,p)</span>
<span id="cb83-762"><a href="#cb83-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-763"><a href="#cb83-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-764"><a href="#cb83-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-765"><a href="#cb83-765" aria-hidden="true" tabindex="-1"></a>We see a large likelihood of values in the range of the +<span class="in">`r z`</span> difference observed, and a low likelihood of a difference of 10 or more in either direction.</span>
<span id="cb83-766"><a href="#cb83-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-767"><a href="#cb83-767" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adaptation: 'of this magnitude or smaller'</span></span>
<span id="cb83-768"><a href="#cb83-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-771"><a href="#cb83-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-772"><a href="#cb83-772" aria-hidden="true" tabindex="-1"></a>ltmag_diffBin <span class="ot">&lt;-</span> <span class="cf">function</span>(z, n1, p1, n2, p2){</span>
<span id="cb83-773"><a href="#cb83-773" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb83-774"><a href="#cb83-774" aria-hidden="true" tabindex="-1"></a>  z_n <span class="ot">&lt;-</span> <span class="sc">-</span>z <span class="co">#negative value</span></span>
<span id="cb83-775"><a href="#cb83-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-776"><a href="#cb83-776" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> z_n<span class="sc">:</span>z){     <span class="co">#sum for all integer differences between observed value and its negative, inclusive</span></span>
<span id="cb83-777"><a href="#cb83-777" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> prob <span class="sc">+</span> <span class="fu">diffBin</span>(i, n1, p1, n2, p2)</span>
<span id="cb83-778"><a href="#cb83-778" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-779"><a href="#cb83-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-780"><a href="#cb83-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prob)</span>
<span id="cb83-781"><a href="#cb83-781" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-782"><a href="#cb83-782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-783"><a href="#cb83-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-784"><a href="#cb83-784" aria-hidden="true" tabindex="-1"></a>Now, a similar computation as above, but for 'a difference this big or smaller in magnitude':</span>
<span id="cb83-785"><a href="#cb83-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-788"><a href="#cb83-788" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-789"><a href="#cb83-789" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb83-790"><a href="#cb83-790" aria-hidden="true" tabindex="-1"></a>    mag_db_0 <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb83-791"><a href="#cb83-791" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-792"><a href="#cb83-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-793"><a href="#cb83-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-794"><a href="#cb83-794" aria-hidden="true" tabindex="-1"></a>This implies there is a <span class="in">`r op(mag_db_0*100)`</span>% chance of getting a difference *no larger than this one in magnitude* of +/-<span class="in">`r z`</span> incidences between the treatments if the true incidence rates were equal.</span>
<span id="cb83-795"><a href="#cb83-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-796"><a href="#cb83-796" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb83-797"><a href="#cb83-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-798"><a href="#cb83-798" aria-hidden="true" tabindex="-1"></a>**And finally, what we were looking for:** the chance of 'a difference this small or smaller' as a function of the **true difference...**</span>
<span id="cb83-799"><a href="#cb83-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-800"><a href="#cb83-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-801"><a href="#cb83-801" aria-hidden="true" tabindex="-1"></a> (Think about: should we do this for 'a difference in the same direction' instead?)</span>
<span id="cb83-802"><a href="#cb83-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-803"><a href="#cb83-803" aria-hidden="true" tabindex="-1"></a>Set up an arbitrary vector of 'true differences' <span class="co">&lt;!-- (to keep it simple, only change it in one direction for now ...) --&gt;</span></span>
<span id="cb83-804"><a href="#cb83-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-805"><a href="#cb83-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-806"><a href="#cb83-806" aria-hidden="true" tabindex="-1"></a>Below, I plot</span>
<span id="cb83-807"><a href="#cb83-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-808"><a href="#cb83-808" aria-hidden="true" tabindex="-1"></a>Y-axis: ’how likely would be a difference in donations ‘as small or smaller in magnitude’” than we see in the data  against...</span>
<span id="cb83-809"><a href="#cb83-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-810"><a href="#cb83-810" aria-hidden="true" tabindex="-1"></a>X-axis: if the “true difference in incidence rates” were of these magnitudes</span>
<span id="cb83-811"><a href="#cb83-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-812"><a href="#cb83-812" aria-hidden="true" tabindex="-1"></a>(Note: this should cover 'a difference in either direction'; the probability of a difference in the direction we *do* see is obviously somewhat smaller)</span>
<span id="cb83-813"><a href="#cb83-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-816"><a href="#cb83-816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-817"><a href="#cb83-817" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb83-818"><a href="#cb83-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-819"><a href="#cb83-819" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>)</span>
<span id="cb83-820"><a href="#cb83-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-821"><a href="#cb83-821" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rep</span>((d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2), <span class="fu">length</span>(B))</span>
<span id="cb83-822"><a href="#cb83-822" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1<span class="sc">*</span>B</span>
<span id="cb83-823"><a href="#cb83-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-824"><a href="#cb83-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-825"><a href="#cb83-825" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(<span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">digits=</span><span class="dv">3</span>, <span class="at">scientific=</span><span class="cn">FALSE</span>)</span>
<span id="cb83-826"><a href="#cb83-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-827"><a href="#cb83-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-828"><a href="#cb83-828" aria-hidden="true" tabindex="-1"></a>probmag <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb83-829"><a href="#cb83-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-830"><a href="#cb83-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-831"><a href="#cb83-831" aria-hidden="true" tabindex="-1"></a><span class="co">#qplot(B, probmag, log  = "x", xlab = "True relative incidence", ylab ="Prob. of difference this small")</span></span>
<span id="cb83-832"><a href="#cb83-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-833"><a href="#cb83-833" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-834"><a href="#cb83-834" aria-hidden="true" tabindex="-1"></a>  probmag_plot <span class="ot">&lt;-</span></span>
<span id="cb83-835"><a href="#cb83-835" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-836"><a href="#cb83-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>B, <span class="at">y=</span>probmag) <span class="sc">+</span></span>
<span id="cb83-837"><a href="#cb83-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb83-838"><a href="#cb83-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb83-839"><a href="#cb83-839" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-840"><a href="#cb83-840" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"True relative incidence rate"</span>) <span class="sc">+</span></span>
<span id="cb83-841"><a href="#cb83-841" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Prob. diff. as small as obsd"</span>)</span>
<span id="cb83-842"><a href="#cb83-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-843"><a href="#cb83-843" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-844"><a href="#cb83-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-845"><a href="#cb83-845" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-846"><a href="#cb83-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-847"><a href="#cb83-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-848"><a href="#cb83-848" aria-hidden="true" tabindex="-1"></a>Hard-coded takeaways 15 Dec 2021 :</span>
<span id="cb83-849"><a href="#cb83-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-850"><a href="#cb83-850" aria-hidden="true" tabindex="-1"></a>Our data is consistent with ‘no difference’ (of course) ... but its also consistent with ‘a fairly large difference in incidence’</span>
<span id="cb83-851"><a href="#cb83-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-852"><a href="#cb83-852" aria-hidden="true" tabindex="-1"></a>E.g., even if one treatment truly lead to ‘twice as many donations as the other’, we still have a 20% chance of seeing a differences as small as the one we see (of 8 versus 6)</span>
<span id="cb83-853"><a href="#cb83-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-854"><a href="#cb83-854" aria-hidden="true" tabindex="-1"></a>We can reasonably ‘rule out’ differences of maybe 2.5x or greater</span>
<span id="cb83-855"><a href="#cb83-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-856"><a href="#cb83-856" aria-hidden="true" tabindex="-1"></a>Main point: given the rareness of donations in this context, our sample size doesn’t let us make very strong conclusions in either directions … at least not yet. I hope that combined with other evidence, we will be able to infer more</span>
<span id="cb83-857"><a href="#cb83-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-858"><a href="#cb83-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-859"><a href="#cb83-859" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quick redo assuming equal shares recieved each email, and treating 'email reciepts as denom'</span></span>
<span id="cb83-860"><a href="#cb83-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-861"><a href="#cb83-861" aria-hidden="true" tabindex="-1"></a>Approx 4000 total emails sent?</span>
<span id="cb83-862"><a href="#cb83-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-863"><a href="#cb83-863" aria-hidden="true" tabindex="-1"></a>For squarespace</span>
<span id="cb83-864"><a href="#cb83-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-867"><a href="#cb83-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-868"><a href="#cb83-868" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb83-869"><a href="#cb83-869" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb83-870"><a href="#cb83-870" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb83-871"><a href="#cb83-871" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb83-872"><a href="#cb83-872" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> d1<span class="sc">-</span>d2</span>
<span id="cb83-873"><a href="#cb83-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-874"><a href="#cb83-874" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">2.5</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>)</span>
<span id="cb83-875"><a href="#cb83-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-876"><a href="#cb83-876" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rep</span>((d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2), <span class="fu">length</span>(B))</span>
<span id="cb83-877"><a href="#cb83-877" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1<span class="sc">*</span>B</span>
<span id="cb83-878"><a href="#cb83-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-879"><a href="#cb83-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-880"><a href="#cb83-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-881"><a href="#cb83-881" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-882"><a href="#cb83-882" aria-hidden="true" tabindex="-1"></a>    mag_db_0_ss <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb83-883"><a href="#cb83-883" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-884"><a href="#cb83-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-885"><a href="#cb83-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-886"><a href="#cb83-886" aria-hidden="true" tabindex="-1"></a>probmag_ss <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb83-887"><a href="#cb83-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-888"><a href="#cb83-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-889"><a href="#cb83-889" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-890"><a href="#cb83-890" aria-hidden="true" tabindex="-1"></a>  probmag_plot_ss <span class="ot">&lt;-</span></span>
<span id="cb83-891"><a href="#cb83-891" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-892"><a href="#cb83-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>B, <span class="at">y=</span>probmag_ss) <span class="sc">+</span></span>
<span id="cb83-893"><a href="#cb83-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb83-894"><a href="#cb83-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb83-895"><a href="#cb83-895" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,.<span class="dv">51</span>) <span class="sc">+</span></span>
<span id="cb83-896"><a href="#cb83-896" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"True relative incidence rate"</span>) <span class="sc">+</span></span>
<span id="cb83-897"><a href="#cb83-897" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Prob. diff. as small as obsd"</span>)</span>
<span id="cb83-898"><a href="#cb83-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-899"><a href="#cb83-899" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-900"><a href="#cb83-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-901"><a href="#cb83-901" aria-hidden="true" tabindex="-1"></a><span class="co">#note that it is not symmetric bc (I think) a very low incidence on one side makes particular large observed proportional differences more likely</span></span>
<span id="cb83-902"><a href="#cb83-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-903"><a href="#cb83-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-904"><a href="#cb83-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-905"><a href="#cb83-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-906"><a href="#cb83-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-907"><a href="#cb83-907" aria-hidden="true" tabindex="-1"></a>For all one-time donations</span>
<span id="cb83-908"><a href="#cb83-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-909"><a href="#cb83-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-912"><a href="#cb83-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-913"><a href="#cb83-913" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb83-914"><a href="#cb83-914" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb83-915"><a href="#cb83-915" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb83-916"><a href="#cb83-916" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb83-917"><a href="#cb83-917" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> d1<span class="sc">-</span>d2</span>
<span id="cb83-918"><a href="#cb83-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-919"><a href="#cb83-919" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">2.5</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>)</span>
<span id="cb83-920"><a href="#cb83-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-921"><a href="#cb83-921" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rep</span>((d1<span class="sc">+</span>d2)<span class="sc">/</span>(n1<span class="sc">+</span>n2), <span class="fu">length</span>(B))</span>
<span id="cb83-922"><a href="#cb83-922" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1<span class="sc">*</span>B</span>
<span id="cb83-923"><a href="#cb83-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-924"><a href="#cb83-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-925"><a href="#cb83-925" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-926"><a href="#cb83-926" aria-hidden="true" tabindex="-1"></a>    mag_db_0 <span class="ot">&lt;-</span> <span class="fu">ltmag_diffBin</span>(z, n1, p1, n2, p2)</span>
<span id="cb83-927"><a href="#cb83-927" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-928"><a href="#cb83-928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-929"><a href="#cb83-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-930"><a href="#cb83-930" aria-hidden="true" tabindex="-1"></a>(the below halts on build, so I commented it out)</span>
<span id="cb83-931"><a href="#cb83-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-932"><a href="#cb83-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-933"><a href="#cb83-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r , eval=FALSE}</span></span>
<span id="cb83-934"><a href="#cb83-934" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: probmag_plot_ot</span></span>
<span id="cb83-935"><a href="#cb83-935" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "probmag_plot_ot"</span></span>
<span id="cb83-936"><a href="#cb83-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-937"><a href="#cb83-937" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb83-938"><a href="#cb83-938" aria-hidden="true" tabindex="-1"></a>  probmag_plot_ot <span class="ot">&lt;-</span></span>
<span id="cb83-939"><a href="#cb83-939" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-940"><a href="#cb83-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>B, <span class="at">y=</span>probmag) <span class="sc">+</span></span>
<span id="cb83-941"><a href="#cb83-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb83-942"><a href="#cb83-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb83-943"><a href="#cb83-943" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,.<span class="dv">51</span>) <span class="sc">+</span></span>
<span id="cb83-944"><a href="#cb83-944" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"True relative incidence rate"</span>) <span class="sc">+</span></span>
<span id="cb83-945"><a href="#cb83-945" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Prob. diff. as small as obsd"</span>)</span>
<span id="cb83-946"><a href="#cb83-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-947"><a href="#cb83-947" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-948"><a href="#cb83-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-949"><a href="#cb83-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-950"><a href="#cb83-950" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-951"><a href="#cb83-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-952"><a href="#cb83-952" aria-hidden="true" tabindex="-1"></a><span class="fu">## Demographics and interactions (to do)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>